# ä»£ç è´¨é‡æ£€æŸ¥æµç¨‹

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†é¡¹ç›®çš„ä»£ç è´¨é‡æ£€æŸ¥æµç¨‹ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æ£€æŸ¥ã€æ‰‹åŠ¨å®¡æŸ¥ã€è´¨é‡é—¨æ§ç­‰ç¯èŠ‚ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œé¡¹ç›®ç¨³å®šæ€§ã€‚

## 1. è‡ªåŠ¨åŒ–æ£€æŸ¥æµç¨‹

### 1.1 é¢„æäº¤æ£€æŸ¥ (Pre-commit Hooks)

```bash
# å®‰è£… husky å’Œ lint-staged
npm install --save-dev husky lint-staged

# é…ç½® package.json
{
  "scripts": {
    "prepare": "husky install",
    "lint": "next lint",
    "lint:fix": "next lint --fix",
    "type-check": "tsc --noEmit",
    "format": "prettier --write .",
    "format:check": "prettier --check ."
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  }
}
```

### 1.2 æŒç»­é›†æˆæ£€æŸ¥ (CI/CD)

```yaml
# .github/workflows/quality-check.yml
name: Code Quality Check

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  quality-check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: TypeScript type check
        run: npm run type-check

      - name: ESLint check
        run: npm run lint

      - name: Prettier check
        run: npm run format:check

      - name: Run tests
        run: npm run test

      - name: Build check
        run: npm run build
```

## 2. ä»£ç è´¨é‡é—¨æ§

### 2.1 è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡            | ç›®æ ‡å€¼ | æ£€æŸ¥å·¥å…·          |
| --------------- | ------ | ----------------- |
| TypeScript é”™è¯¯ | 0      | `tsc --noEmit`    |
| ESLint è¿è§„     | 0      | `eslint`          |
| æµ‹è¯•è¦†ç›–ç‡      | >80%   | `jest --coverage` |
| æ„å»ºæˆåŠŸç‡      | 100%   | `npm run build`   |
| ä»£ç é‡å¤ç‡      | <5%    | `jscpd`           |

### 2.2 è´¨é‡é—¨æ§è§„åˆ™

```typescript
// è´¨é‡é—¨æ§é…ç½®
interface QualityGates {
  typescript: {
    enabled: true;
    maxErrors: 0;
    maxWarnings: 0;
  };
  eslint: {
    enabled: true;
    maxErrors: 0;
    maxWarnings: 10;
  };
  testCoverage: {
    enabled: true;
    minCoverage: 80;
    branches: 70;
    functions: 80;
    lines: 80;
  };
  build: {
    enabled: true;
    mustPass: true;
  };
}
```

## 3. ä»£ç å®¡æŸ¥æµç¨‹

### 3.1 å®¡æŸ¥æ¸…å•

#### åŠŸèƒ½å®¡æŸ¥

- [ ] åŠŸèƒ½å®ç°ç¬¦åˆéœ€æ±‚
- [ ] è¾¹ç•Œæ¡ä»¶å¤„ç†æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ€§èƒ½è€ƒè™‘åˆç†

#### ä»£ç è´¨é‡å®¡æŸ¥

- [ ] å‘½åè§„èŒƒç¬¦åˆæ ‡å‡†
- [ ] ç±»å‹å®šä¹‰æ­£ç¡®å®Œæ•´
- [ ] æ³¨é‡Šæ¸…æ™°å‡†ç¡®
- [ ] ä»£ç ç»“æ„æ¸…æ™°
- [ ] æ— é‡å¤ä»£ç 

#### å®‰å…¨å®¡æŸ¥

- [ ] è¾“å…¥éªŒè¯å……åˆ†
- [ ] æ•æ„Ÿä¿¡æ¯å¤„ç†å®‰å…¨
- [ ] æƒé™æ£€æŸ¥æ­£ç¡®
- [ ] æ— å®‰å…¨æ¼æ´

#### æµ‹è¯•å®¡æŸ¥

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–å……åˆ†
- [ ] é›†æˆæµ‹è¯•å®Œæ•´
- [ ] æµ‹è¯•ç”¨ä¾‹è´¨é‡é«˜
- [ ] æµ‹è¯•æ•°æ®åˆç†

### 3.2 å®¡æŸ¥æµç¨‹

1. **åˆ›å»º Pull Request**
   - å¡«å†™è¯¦ç»†çš„æè¿°
   - å…³è”ç›¸å…³ Issue
   - æ·»åŠ é€‚å½“çš„æ ‡ç­¾

2. **è‡ªåŠ¨æ£€æŸ¥**
   - CI/CD è‡ªåŠ¨è¿è¡Œæ£€æŸ¥
   - ç¡®ä¿æ‰€æœ‰æ£€æŸ¥é€šè¿‡

3. **ä»£ç å®¡æŸ¥**
   - è‡³å°‘2äººå®¡æŸ¥
   - å®¡æŸ¥æ„è§åŠæ—¶å›å¤
   - ä¿®æ”¹åé‡æ–°å®¡æŸ¥

4. **åˆå¹¶å‰æ£€æŸ¥**
   - æ‰€æœ‰æ£€æŸ¥é€šè¿‡
   - å®¡æŸ¥æ„è§å·²è§£å†³
   - ä»£ç å·²æ›´æ–°åˆ°æœ€æ–°

## 4. è´¨é‡ç›‘æ§

### 4.1 ä»£ç è´¨é‡æŠ¥å‘Š

```typescript
// è´¨é‡æŠ¥å‘Šç”Ÿæˆ
interface QualityReport {
  timestamp: string;
  project: string;
  branch: string;
  commit: string;
  metrics: {
    typescript: TypeScriptMetrics;
    eslint: ESLintMetrics;
    testCoverage: CoverageMetrics;
    build: BuildMetrics;
  };
  trends: {
    qualityScore: number;
    trend: 'up' | 'down' | 'stable';
  };
}
```

### 4.2 è´¨é‡è¶‹åŠ¿åˆ†æ

- æ¯æ—¥è´¨é‡æŠ¥å‘Š
- å‘¨åº¦è´¨é‡è¶‹åŠ¿
- æœˆåº¦è´¨é‡æ€»ç»“
- è´¨é‡æ”¹è¿›å»ºè®®

## 5. å·¥å…·é…ç½®

### 5.1 ESLint é…ç½®

```json
{
  "extends": [
    "next/core-web-vitals",
    "next/typescript",
    "@typescript-eslint/recommended",
    "@typescript-eslint/recommended-requiring-type-checking"
  ],
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-unsafe-assignment": "error",
    "@typescript-eslint/no-unsafe-call": "error",
    "@typescript-eslint/no-unsafe-member-access": "error",
    "@typescript-eslint/no-unsafe-return": "error",
    "prefer-const": "error",
    "no-var": "error",
    "no-console": "warn",
    "no-debugger": "error"
  }
}
```

### 5.2 TypeScript é…ç½®

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noUncheckedIndexedAccess": true,
    "noUncheckedIndexedAccess": true
  }
}
```

### 5.3 Jest é…ç½®

```json
{
  "collectCoverage": true,
  "coverageDirectory": "coverage",
  "coverageReporters": ["text", "lcov", "html"],
  "coverageThreshold": {
    "global": {
      "branches": 70,
      "functions": 80,
      "lines": 80,
      "statements": 80
    }
  }
}
```

## 6. è´¨é‡æ”¹è¿›æµç¨‹

### 6.1 é—®é¢˜è¯†åˆ«

- è‡ªåŠ¨åŒ–æ£€æŸ¥å‘ç°çš„é—®é¢˜
- ä»£ç å®¡æŸ¥å‘ç°çš„é—®é¢˜
- ç”Ÿäº§ç¯å¢ƒåé¦ˆçš„é—®é¢˜
- æ€§èƒ½ç›‘æ§å‘ç°çš„é—®é¢˜

### 6.2 é—®é¢˜åˆ†ç±»

| ä¼˜å…ˆçº§ | ç±»å‹       | å¤„ç†æ—¶é—´ | ç¤ºä¾‹                   |
| ------ | ---------- | -------- | ---------------------- |
| P0     | é˜»å¡æ€§é—®é¢˜ | ç«‹å³     | æ„å»ºå¤±è´¥ã€ç±»å‹é”™è¯¯     |
| P1     | é«˜ä¼˜å…ˆçº§   | 1å¤©å†…    | å®‰å…¨æ¼æ´ã€æ€§èƒ½é—®é¢˜     |
| P2     | ä¸­ä¼˜å…ˆçº§   | 3å¤©å†…    | ä»£ç è§„èŒƒè¿è§„ã€æµ‹è¯•å¤±è´¥ |
| P3     | ä½ä¼˜å…ˆçº§   | 1å‘¨å†…    | ä»£ç ä¼˜åŒ–å»ºè®®           |

### 6.3 æ”¹è¿›æªæ–½

1. **ç«‹å³ä¿®å¤**ï¼šP0 å’Œ P1 é—®é¢˜
2. **è®¡åˆ’ä¿®å¤**ï¼šP2 å’Œ P3 é—®é¢˜
3. **é¢„é˜²æªæ–½**ï¼šæ›´æ–°è§„èŒƒå’Œå·¥å…·
4. **åŸ¹è®­æå‡**ï¼šå›¢é˜ŸæŠ€èƒ½æå‡

## 7. è´¨é‡åº¦é‡

### 7.1 å…³é”®æŒ‡æ ‡

```typescript
interface QualityMetrics {
  // ä»£ç è´¨é‡
  codeQuality: {
    typescriptErrors: number;
    eslintViolations: number;
    codeDuplication: number;
    cyclomaticComplexity: number;
  };

  // æµ‹è¯•è´¨é‡
  testQuality: {
    coverage: number;
    testCount: number;
    testPassRate: number;
    testExecutionTime: number;
  };

  // æ„å»ºè´¨é‡
  buildQuality: {
    buildSuccessRate: number;
    buildTime: number;
    bundleSize: number;
    performanceScore: number;
  };

  // ç»´æŠ¤æ€§
  maintainability: {
    technicalDebt: number;
    codeSmells: number;
    maintainabilityIndex: number;
  };
}
```

### 7.2 è´¨é‡è¯„åˆ†

```typescript
function calculateQualityScore(metrics: QualityMetrics): number {
  const weights = {
    typescriptErrors: 0.3,
    eslintViolations: 0.2,
    testCoverage: 0.2,
    buildSuccessRate: 0.2,
    maintainabilityIndex: 0.1,
  };

  const score =
    (1 - metrics.codeQuality.typescriptErrors / 100) *
      weights.typescriptErrors +
    (1 - metrics.codeQuality.eslintViolations / 100) *
      weights.eslintViolations +
    (metrics.testQuality.coverage / 100) * weights.testCoverage +
    (metrics.buildQuality.buildSuccessRate / 100) * weights.buildSuccessRate +
    (metrics.maintainability.maintainabilityIndex / 100) *
      weights.maintainabilityIndex;

  return Math.round(score * 100);
}
```

## 8. å›¢é˜Ÿåä½œ

### 8.1 è§’è‰²èŒè´£

| è§’è‰²       | èŒè´£                         |
| ---------- | ---------------------------- |
| å¼€å‘è€…     | ç¼–å†™é«˜è´¨é‡ä»£ç ï¼Œé€šè¿‡æ‰€æœ‰æ£€æŸ¥ |
| å®¡æŸ¥è€…     | ä»£ç å®¡æŸ¥ï¼Œç¡®ä¿è´¨é‡æ ‡å‡†       |
| æŠ€æœ¯è´Ÿè´£äºº | åˆ¶å®šè´¨é‡è§„èŒƒï¼Œç›‘æ§è´¨é‡è¶‹åŠ¿   |
| é¡¹ç›®ç»ç†   | åè°ƒè´¨é‡æ”¹è¿›ï¼Œèµ„æºåˆ†é…       |

### 8.2 æ²Ÿé€šæœºåˆ¶

- æ¯æ—¥ç«™ä¼šï¼šè´¨é‡çŠ¶æ€åŒæ­¥
- å‘¨åº¦å›é¡¾ï¼šè´¨é‡æ”¹è¿›è®¨è®º
- æœˆåº¦æ€»ç»“ï¼šè´¨é‡è¶‹åŠ¿åˆ†æ
- å­£åº¦è§„åˆ’ï¼šè´¨é‡ç›®æ ‡åˆ¶å®š

## 9. å·¥å…·é›†æˆ

### 9.1 IDE é›†æˆ

```json
// .vscode/settings.json
{
  "typescript.preferences.includePackageJsonAutoImports": "on",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": true
  },
  "eslint.validate": ["typescript", "typescriptreact"]
}
```

### 9.2 ä»£ç è´¨é‡å·¥å…·

- **ESLint**: ä»£ç è§„èŒƒæ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **TypeScript**: ç±»å‹æ£€æŸ¥
- **Jest**: å•å…ƒæµ‹è¯•
- **Husky**: Git é’©å­
- **Lint-staged**: æš‚å­˜æ–‡ä»¶æ£€æŸ¥

## 10. æŒç»­æ”¹è¿›

### 10.1 å®šæœŸè¯„ä¼°

- æ¯æœˆè¯„ä¼°è´¨é‡æŒ‡æ ‡
- æ¯å­£åº¦æ›´æ–°è´¨é‡è§„èŒƒ
- æ¯å¹´åˆ¶å®šè´¨é‡ç›®æ ‡
- æŒç»­ä¼˜åŒ–å·¥å…·é…ç½®

### 10.2 æœ€ä½³å®è·µåˆ†äº«

- ä»£ç è´¨é‡æ¡ˆä¾‹åˆ†äº«
- å·¥å…·ä½¿ç”¨æŠ€å·§åŸ¹è®­
- é—®é¢˜è§£å†³æ–¹æ¡ˆæ€»ç»“
- å›¢é˜Ÿç»éªŒäº¤æµ

---

## é™„å½•

### A. è´¨é‡æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# quality-check.sh

echo "ğŸ” å¼€å§‹ä»£ç è´¨é‡æ£€æŸ¥..."

# TypeScript ç±»å‹æ£€æŸ¥
echo "ğŸ“ TypeScript ç±»å‹æ£€æŸ¥..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥"
  exit 1
fi

# ESLint æ£€æŸ¥
echo "ğŸ”§ ESLint æ£€æŸ¥..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint æ£€æŸ¥å¤±è´¥"
  exit 1
fi

# ä»£ç æ ¼å¼åŒ–æ£€æŸ¥
echo "ğŸ’… ä»£ç æ ¼å¼åŒ–æ£€æŸ¥..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ ä»£ç æ ¼å¼åŒ–æ£€æŸ¥å¤±è´¥"
  exit 1
fi

# æµ‹è¯•è¿è¡Œ
echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
npm run test
if [ $? -ne 0 ]; then
  echo "âŒ æµ‹è¯•å¤±è´¥"
  exit 1
fi

# æ„å»ºæ£€æŸ¥
echo "ğŸ—ï¸ æ„å»ºæ£€æŸ¥..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ æ„å»ºå¤±è´¥"
  exit 1
fi

echo "âœ… æ‰€æœ‰è´¨é‡æ£€æŸ¥é€šè¿‡ï¼"
```

### B. è´¨é‡æŠ¥å‘Šæ¨¡æ¿

```markdown
# ä»£ç è´¨é‡æŠ¥å‘Š - {æ—¥æœŸ}

## æ€»ä½“è´¨é‡è¯„åˆ†

- å½“å‰è¯„åˆ†: {score}/100
- è¶‹åŠ¿: {trend}
- çŠ¶æ€: {status}

## è¯¦ç»†æŒ‡æ ‡

| æŒ‡æ ‡            | å½“å‰å€¼              | ç›®æ ‡å€¼ | çŠ¶æ€              |
| --------------- | ------------------- | ------ | ----------------- |
| TypeScript é”™è¯¯ | {ts_errors}         | 0      | {ts_status}       |
| ESLint è¿è§„     | {eslint_violations} | 0      | {eslint_status}   |
| æµ‹è¯•è¦†ç›–ç‡      | {coverage}%         | 80%    | {coverage_status} |
| æ„å»ºæˆåŠŸç‡      | {build_rate}%       | 100%   | {build_status}    |

## é—®é¢˜æ€»ç»“

- æ–°å¢é—®é¢˜: {new_issues}
- å·²è§£å†³é—®é¢˜: {resolved_issues}
- å¾…è§£å†³é—®é¢˜: {pending_issues}

## æ”¹è¿›å»ºè®®

{improvement_suggestions}
```

---

_æœ¬æ–‡æ¡£å°†æ ¹æ®é¡¹ç›®å‘å±•å’Œå›¢é˜Ÿåé¦ˆæŒç»­æ›´æ–°å’Œå®Œå–„ã€‚_
