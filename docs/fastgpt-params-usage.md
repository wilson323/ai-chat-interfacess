# FastGPT智能体参数获取功能使用指南

## 功能概述

FastGPT智能体参数获取功能允许管理员通过API密钥和App ID自动从FastGPT平台获取智能体配置信息，包括：

- 智能体名称和描述
- 欢迎语设置
- 全局变量配置
- 多模态模型设置
- 文件上传支持配置

## 使用步骤

### 1. 准备工作

在使用参数获取功能之前，您需要：

1. **获取FastGPT API密钥**
   - 登录FastGPT平台
   - 在设置中生成API密钥
   - 格式通常为：`fastgpt-xxxxxxxxxxxx`

2. **获取App ID**
   - 在FastGPT应用详情页面的URL中获取
   - 格式通常为：`c-xxxxxxxxxxxxxxxx`

### 2. 创建或编辑FastGPT智能体

1. 进入管理后台的智能体管理页面
2. 点击"新增智能体"或编辑现有的FastGPT类型智能体
3. 在"高级设置"选项卡中找到API配置区域

### 3. 配置API信息

1. **输入API端点**（通常保持默认值）：
   ```
   https://zktecoaihub.com/api/v1/chat/completions
   ```

2. **输入API密钥**：
   ```
   fastgpt-your-api-key-here
   ```

3. **输入App ID**：
   ```
   c-your-app-id-here
   ```

### 4. 获取参数

1. 确保API密钥和App ID都已正确填写
2. 点击"获取参数"按钮
3. 系统将自动调用FastGPT初始化接口获取配置信息
4. 成功后，相关字段将自动回填

### 5. 查看全局变量

在"高级设置"选项卡的底部，您可以看到"全局变量"区域，显示：

- **变量名**：变量的显示名称
- **类型**：变量类型（文本、选择框、自定义等）
- **是否必填**：标识该变量是否为必填项
- **描述**：变量的详细说明

## 支持的变量类型

| FastGPT类型 | 中文显示 | 说明 |
|------------|---------|------|
| text | 文本 | 普通文本输入 |
| select | 选择框 | 下拉选择 |
| custom | 自定义 | 自定义类型 |
| number | 数字 | 数字输入 |
| boolean | 布尔值 | 是/否选择 |
| option | 选项 | 选项类型 |

## 常见问题

### Q: 点击"获取参数"按钮没有反应？

**A:** 请检查：
1. API密钥和App ID是否正确填写
2. 网络连接是否正常
3. FastGPT服务是否可访问
4. 查看浏览器控制台是否有错误信息

### Q: 获取参数失败，提示"无法从FastGPT获取配置信息"？

**A:** 可能的原因：
1. API密钥已过期或无效
2. App ID不存在或无权限访问
3. FastGPT API端点配置错误
4. 网络连接问题

### Q: 全局变量显示为空？

**A:** 这是正常情况，可能的原因：
1. 该FastGPT应用确实没有配置全局变量
2. 您的API密钥没有访问该应用变量配置的权限
3. 应用配置中的变量数组为空

### Q: 获取的参数信息不完整？

**A:** 请检查：
1. FastGPT应用是否完整配置了相关信息
2. API密钥是否有足够的权限
3. 应用类型是否为"高级"类型

## 技术说明

### 数据存储

- 全局变量以JSON格式存储在数据库的`global_variables`字段中
- 欢迎语存储在`welcome_text`字段中
- 所有配置信息都会同步保存到本地数据库

### API调用流程

1. 用户点击"获取参数"按钮
2. 前端调用`/api/chat-proxy`代理接口
3. 代理接口调用FastGPT的`/api/v1/chat/init`接口
4. 解析返回的配置信息
5. 自动回填表单字段
6. 保存时将配置存储到数据库

### 安全性

- API密钥在传输过程中使用HTTPS加密
- 敏感信息不会在前端明文存储
- 所有API调用都通过服务端代理进行

## 用户端全局变量功能

### 自动参数检查

当用户在用户端切换智能体或新建对话时，系统会自动检查该智能体是否有必填的全局变量：

1. **无需填写的情况**：
   - 智能体没有配置全局变量
   - 智能体的全局变量都是非必填的
   - 用户之前已经填写过必填变量

2. **需要填写的情况**：
   - 智能体有必填的全局变量且用户未填写
   - 用户之前填写的变量不完整

### 变量填写界面

当需要填写全局变量时，系统会自动弹出参数配置对话框：

- **智能提示**：显示智能体名称和参数说明
- **表单验证**：实时验证必填项、长度限制、数据类型
- **自动保存**：用户填写的值会自动保存到本地
- **自动回填**：下次使用相同智能体时自动加载之前的值

### 对话中的参数传递

用户填写的全局变量会在每次FastGPT对话中自动传递：

- **透明传递**：用户无需关心技术细节，参数会自动包含在API请求中
- **实时更新**：修改变量值后立即生效
- **会话保持**：在整个对话会话中保持变量值

## 更新日志

### v2.0.0 (2024-12-19)
- ✅ 新增用户端全局变量验证功能
- ✅ 实现智能体切换时的自动参数检查
- ✅ 添加用户友好的变量填写界面
- ✅ 支持FastGPT对话中的全局变量传递
- ✅ 完善localStorage自动保存和加载

### v1.0.0 (2024-12-19)
- ✅ 实现基础参数获取功能
- ✅ 支持全局变量解析和显示
- ✅ 添加变量类型中文映射
- ✅ 完善错误处理和用户提示
- ✅ 添加数据库存储支持

## 支持

如果您在使用过程中遇到问题，请：

1. 查看浏览器控制台的错误信息
2. 检查网络连接和API配置
3. 联系技术支持团队

---

*本文档随功能更新而持续维护，最后更新时间：2024-12-19*
