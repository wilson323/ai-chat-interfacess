# TypeScript ç±»å‹å®‰å…¨ç»´æŠ¤ä½“ç³»

## ğŸ¯ ç»´æŠ¤ç›®æ ‡

ç¡®ä¿é¡¹ç›®é•¿æœŸä¿æŒç±»å‹å®‰å…¨ï¼Œæå‡ä»£ç è´¨é‡å’Œå¼€å‘æ•ˆç‡ã€‚

## ğŸ“‹ ç»´æŠ¤ç­–ç•¥

### 1. æŒç»­ç»´æŠ¤ï¼šä¿æŒ TypeScript ä¸¥æ ¼æ¨¡å¼

#### 1.1 é…ç½®æ£€æŸ¥æ¸…å•
- [ ] `tsconfig.json` ä¸¥æ ¼æ¨¡å¼é…ç½®
- [ ] ç¼–è¯‘é€‰é¡¹ä¼˜åŒ–
- [ ] ç±»å‹æ£€æŸ¥è§„åˆ™

#### 1.2 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬
```bash
# ç±»å‹æ£€æŸ¥è„šæœ¬
npm run type-check

# ä¸¥æ ¼æ¨¡å¼éªŒè¯
npm run type-check:strict

# ç±»å‹è¦†ç›–ç‡æ£€æŸ¥
npm run type-coverage
```

#### 1.3 é…ç½®æœ€ä½³å®è·µ
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true
  }
}
```

### 2. ä»£ç å®¡æŸ¥ï¼šé‡ç‚¹å…³æ³¨ç±»å‹å®‰å…¨

#### 2.1 å®¡æŸ¥æ£€æŸ¥æ¸…å•
- [ ] æ–°ä»£ç æ˜¯å¦ä½¿ç”¨ `any` ç±»å‹
- [ ] æ³›å‹æ˜¯å¦æœ‰é€‚å½“çš„çº¦æŸ
- [ ] é”™è¯¯å¤„ç†æ˜¯å¦ç±»å‹å®‰å…¨
- [ ] æ¥å£å®šä¹‰æ˜¯å¦å®Œæ•´
- [ ] ç±»å‹æ–­è¨€æ˜¯å¦å®‰å…¨

#### 2.2 å®¡æŸ¥å·¥å…·é…ç½®
```json
{
  "eslint": {
    "rules": {
      "@typescript-eslint/no-explicit-any": "error",
      "@typescript-eslint/no-unsafe-assignment": "error",
      "@typescript-eslint/no-unsafe-call": "error",
      "@typescript-eslint/no-unsafe-member-access": "error",
      "@typescript-eslint/no-unsafe-return": "error"
    }
  }
}
```

#### 2.3 å®¡æŸ¥æµç¨‹
1. **é¢„æäº¤æ£€æŸ¥**ï¼šè‡ªåŠ¨è¿è¡Œç±»å‹æ£€æŸ¥
2. **ä»£ç å®¡æŸ¥**ï¼šé‡ç‚¹å…³æ³¨ç±»å‹å®‰å…¨
3. **åˆå¹¶å‰éªŒè¯**ï¼šç¡®ä¿ç±»å‹æ£€æŸ¥é€šè¿‡
4. **å®šæœŸå®¡è®¡**ï¼šå…¨é¢æ£€æŸ¥ç±»å‹å®‰å…¨

### 3. æµ‹è¯•è¦†ç›–ï¼šæ·»åŠ æ›´å¤šç±»å‹æµ‹è¯•

#### 3.1 ç±»å‹æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•ç±»å‹å®šä¹‰çš„æ­£ç¡®æ€§
- **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•ç±»å‹åœ¨å¤æ‚åœºæ™¯ä¸‹çš„è¡¨ç°
- **ç±»å‹æµ‹è¯•**ï¼šä½¿ç”¨ `tsd` è¿›è¡Œç±»å‹æµ‹è¯•

#### 3.2 ç±»å‹æµ‹è¯•å·¥å…·
```bash
# å®‰è£…ç±»å‹æµ‹è¯•å·¥å…·
npm install --save-dev tsd

# è¿è¡Œç±»å‹æµ‹è¯•
npm run test:types
```

#### 3.3 æµ‹è¯•ç¤ºä¾‹
```typescript
// ç±»å‹æµ‹è¯•ç¤ºä¾‹
import { expectType } from 'tsd';
import { AgentUsageService } from '@/lib/db/models/agent-usage';

// æµ‹è¯•æ–¹æ³•è¿”å›ç±»å‹
expectType<Promise<AgentUsage>>(
  AgentUsageService.startSession('session-1', 1, 1, 'text')
);

// æµ‹è¯•é”™è¯¯å¤„ç†ç±»å‹
expectType<Promise<{ data?: T; error?: AppError }>>(
  ErrorHandler.safeExecute(() => Promise.resolve('test'))
);
```

### 4. æ–‡æ¡£æ›´æ–°ï¼šä¿æŒç±»å‹å®šä¹‰æ–‡æ¡£çš„æ—¶æ•ˆæ€§

#### 4.1 æ–‡æ¡£ç»´æŠ¤ç­–ç•¥
- **è‡ªåŠ¨ç”Ÿæˆ**ï¼šä½¿ç”¨å·¥å…·è‡ªåŠ¨ç”Ÿæˆç±»å‹æ–‡æ¡£
- **å®šæœŸæ›´æ–°**ï¼šæ¯æ¬¡é‡å¤§å˜æ›´åæ›´æ–°æ–‡æ¡£
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ–‡æ¡£ä¸ä»£ç ç‰ˆæœ¬åŒæ­¥

#### 4.2 æ–‡æ¡£ç”Ÿæˆå·¥å…·
```bash
# å®‰è£…æ–‡æ¡£ç”Ÿæˆå·¥å…·
npm install --save-dev typedoc

# ç”Ÿæˆç±»å‹æ–‡æ¡£
npm run docs:types
```

#### 4.3 æ–‡æ¡£ç»“æ„
```
docs/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ api-types.md
â”‚   â”œâ”€â”€ database-types.md
â”‚   â”œâ”€â”€ error-types.md
â”‚   â””â”€â”€ component-types.md
â””â”€â”€ type-changes/
    â”œâ”€â”€ v1.0.0.md
    â””â”€â”€ v1.1.0.md
```

## ğŸ› ï¸ å®æ–½å·¥å…·

### 1. é¢„æäº¤é’©å­
```json
{
  "husky": {
    "hooks": {
      "pre-commit": "npm run type-check && npm run lint:types"
    }
  }
}
```

### 2. CI/CD é›†æˆ
```yaml
# GitHub Actions ç¤ºä¾‹
- name: Type Check
  run: npm run type-check

- name: Type Coverage
  run: npm run type-coverage

- name: Type Tests
  run: npm run test:types
```

### 3. ç›‘æ§ä»ªè¡¨æ¿
- ç±»å‹è¦†ç›–ç‡è¶‹åŠ¿
- ç±»å‹é”™è¯¯æ•°é‡å˜åŒ–
- ç¼–è¯‘æ—¶é—´ç›‘æ§
- ç±»å‹å¤æ‚åº¦åˆ†æ

## ğŸ“Š è´¨é‡æŒ‡æ ‡

### 1. ç±»å‹å®‰å…¨æŒ‡æ ‡
- **ç±»å‹è¦†ç›–ç‡**: > 95%
- **any ç±»å‹ä½¿ç”¨ç‡**: < 1%
- **ç±»å‹é”™è¯¯æ•°é‡**: 0
- **ç¼–è¯‘æ—¶é—´**: < 30s

### 2. ä»£ç è´¨é‡æŒ‡æ ‡
- **ç±»å‹å¤æ‚åº¦**: < 5
- **æ¥å£å®Œæ•´æ€§**: 100%
- **é”™è¯¯å¤„ç†è¦†ç›–ç‡**: > 90%
- **æ–‡æ¡£è¦†ç›–ç‡**: > 80%

### 3. å¼€å‘æ•ˆç‡æŒ‡æ ‡
- **ç±»å‹æç¤ºå‡†ç¡®ç‡**: > 95%
- **é‡æ„æˆåŠŸç‡**: > 98%
- **è°ƒè¯•æ—¶é—´å‡å°‘**: > 30%
- **ä»£ç å®¡æŸ¥æ—¶é—´å‡å°‘**: > 20%

## ğŸ”„ æŒç»­æ”¹è¿›

### 1. å®šæœŸè¯„ä¼°
- **æœˆåº¦è¯„ä¼°**ï¼šç±»å‹å®‰å…¨æŒ‡æ ‡
- **å­£åº¦è¯„ä¼°**ï¼šå·¥å…·å’Œæµç¨‹ä¼˜åŒ–
- **å¹´åº¦è¯„ä¼°**ï¼šæ•´ä½“ç­–ç•¥è°ƒæ•´

### 2. å·¥å…·å‡çº§
- **TypeScript ç‰ˆæœ¬**ï¼šä¿æŒæœ€æ–°ç¨³å®šç‰ˆ
- **ç±»å‹æ£€æŸ¥å·¥å…·**ï¼šå®šæœŸæ›´æ–°
- **æµ‹è¯•å·¥å…·**ï¼šæŒç»­ä¼˜åŒ–

### 3. å›¢é˜ŸåŸ¹è®­
- **ç±»å‹å®‰å…¨æœ€ä½³å®è·µ**
- **å·¥å…·ä½¿ç”¨åŸ¹è®­**
- **ä»£ç å®¡æŸ¥æŠ€å·§**

## ğŸ“š å‚è€ƒèµ„æº

### 1. å®˜æ–¹æ–‡æ¡£
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/docs/)
- [TypeScript ä¸¥æ ¼æ¨¡å¼æŒ‡å—](https://www.typescriptlang.org/tsconfig#strict)

### 2. æœ€ä½³å®è·µ
- [TypeScript æœ€ä½³å®è·µ](https://typescript-eslint.io/docs/linting/typed-linting/)
- [ç±»å‹å®‰å…¨è®¾è®¡æ¨¡å¼](https://www.typescriptlang.org/docs/handbook/2/types-from-types.html)

### 3. å·¥å…·æ–‡æ¡£
- [ESLint TypeScript è§„åˆ™](https://typescript-eslint.io/rules/)
- [TypeDoc æ–‡æ¡£ç”Ÿæˆ](https://typedoc.org/)

---

**ç»´æŠ¤ä½“ç³»å»ºç«‹æ—¶é—´**: 2024å¹´12æœˆ
**ç»´æŠ¤è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
**æ›´æ–°é¢‘ç‡**: æ¯æœˆè¯„ä¼°ï¼Œæ¯å­£åº¦ä¼˜åŒ–
**çŠ¶æ€**: âœ… å·²å»ºç«‹ï¼ŒæŒç»­ç»´æŠ¤ä¸­
