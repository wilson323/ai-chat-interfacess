---
description: åŠŸèƒ½ç´¢å¼•å’ŒAPIæ–‡æ¡£
globs: ["**/*.{ts,tsx,js,jsx}"]
alwaysApply: false
---

# åŠŸèƒ½ç´¢å¼•å’ŒAPIæ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ™ºèƒ½ä½“ç®¡ç†ç³»ç»Ÿ

#### åŠŸèƒ½æ¦‚è¿°
å¤šæ™ºèƒ½ä½“é…ç½®ã€è·¯ç”±ã€è´Ÿè½½å‡è¡¡å’Œæ€§èƒ½ç›‘æ§

#### æ ¸å¿ƒç»„ä»¶
- **AgentContext** - [context/agent-context.tsx](mdc:context/agent-context.tsx)
- **AgentCard** - [components/agent-card.tsx](mdc:components/agent-card.tsx)
- **AgentDialog** - [components/agent-dialog.tsx](mdc:components/agent-dialog.tsx)
- **AgentSidebar** - [components/agent-sidebar.tsx](mdc:components/agent-sidebar.tsx)

#### APIæ¥å£
```typescript
// è·å–æ™ºèƒ½ä½“åˆ—è¡¨
GET /api/agents
Response: Agent[]

// è·å–æ™ºèƒ½ä½“è¯¦æƒ…
GET /api/agents/:id
Response: Agent

// åˆ›å»ºæ™ºèƒ½ä½“
POST /api/agents
Body: CreateAgentRequest
Response: Agent

// æ›´æ–°æ™ºèƒ½ä½“
PUT /api/agents/:id
Body: UpdateAgentRequest
Response: Agent

// åˆ é™¤æ™ºèƒ½ä½“
DELETE /api/agents/:id
Response: { success: boolean }
```

#### æ•°æ®æ¨¡å‹
```typescript
interface Agent {
  id: string
  name: string
  description: string
  apiEndpoint: string
  apiKey: string
  appId: string
  type: 'chat' | 'image-editor' | 'cad-analyzer'
  isPublished: boolean
  systemPrompt: string
  welcomeText: string
  temperature: number
  maxTokens: number
  supportsFileUpload: boolean
  supportsImageUpload: boolean
  multimodalModel?: string
}
```

### 2. å¯¹è¯å¼•æ“

#### åŠŸèƒ½æ¦‚è¿°
å®æ—¶æ¶ˆæ¯å¤„ç†ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€æµå¼å“åº”

#### æ ¸å¿ƒç»„ä»¶
- **ChatContainer** - [components/chat-container.tsx](mdc:components/chat-container.tsx)
- **ChatMessage** - [components/chat-message.tsx](mdc:components/chat-message.tsx)
- **ChatInput** - [components/chat-input.tsx](mdc:components/chat-input.tsx)
- **MessageList** - [components/message-list.tsx](mdc:components/message-list.tsx)

#### APIæ¥å£
```typescript
// å‘é€æ¶ˆæ¯
POST /api/chat/send
Body: {
  message: string
  agentId: string
  conversationId?: string
  files?: File[]
}
Response: {
  messageId: string
  conversationId: string
  response: string
}

// è·å–å¯¹è¯å†å²
GET /api/chat/history/:conversationId
Response: Message[]

// æµå¼å“åº”
GET /api/chat/stream/:messageId
Response: Server-Sent Events

// ä¸­æ­¢å¯¹è¯
POST /api/chat/abort/:messageId
Response: { success: boolean }
```

#### æ•°æ®æ¨¡å‹
```typescript
interface Message {
  id: string
  conversationId: string
  role: 'user' | 'assistant' | 'system'
  content: string
  timestamp: Date
  agentId: string
  files?: File[]
  metadata?: Record<string, any>
}
```

### 3. æ–‡ä»¶å¤„ç†ç³»ç»Ÿ

#### åŠŸèƒ½æ¦‚è¿°
å¤šæ¨¡æ€æ–‡ä»¶ä¸Šä¼ ã€å¤„ç†ã€å­˜å‚¨å’Œç®¡ç†

#### æ ¸å¿ƒç»„ä»¶
- **FileUploader** - [components/file-uploader.tsx](mdc:components/file-uploader.tsx)
- **LazyImage** - [components/lazy-image.tsx](mdc:components/lazy-image.tsx)
- **CodeBlock** - [components/code-block.tsx](mdc:components/code-block.tsx)

#### APIæ¥å£
```typescript
// ä¸Šä¼ æ–‡ä»¶
POST /api/upload
Body: FormData
Response: {
  fileId: string
  fileName: string
  fileSize: number
  fileType: string
  url: string
}

// è·å–æ–‡ä»¶ä¿¡æ¯
GET /api/upload/:fileId
Response: FileInfo

// åˆ é™¤æ–‡ä»¶
DELETE /api/upload/:fileId
Response: { success: boolean }
```

#### æ”¯æŒçš„æ–‡ä»¶ç±»å‹
- **å›¾ç‰‡**: jpg, jpeg, png, gif, webp
- **æ–‡æ¡£**: pdf, doc, docx, txt, md
- **CADæ–‡ä»¶**: dwg, dxf, step, stp
- **éŸ³é¢‘**: mp3, wav, m4a
- **è§†é¢‘**: mp4, avi, mov

### 4. è¯­éŸ³å¤„ç†ç³»ç»Ÿ

#### åŠŸèƒ½æ¦‚è¿°
è¯­éŸ³è¾“å…¥ã€è¯†åˆ«ã€åˆæˆå’Œæ’­æ”¾

#### æ ¸å¿ƒç»„ä»¶
- **VoiceRecorder** - [components/voice/voice-recorder.tsx](mdc:components/voice/voice-recorder.tsx)
- **VoicePlayer** - [components/voice/voice-player.tsx](mdc:components/voice/voice-player.tsx)
- **VoiceSettings** - [components/voice/voice-settings.tsx](mdc:components/voice/voice-settings.tsx)

#### APIæ¥å£
```typescript
// è¯­éŸ³è¯†åˆ«
POST /api/voice/transcribe
Body: FormData (audio file)
Response: {
  text: string
  confidence: number
  language: string
}

// è¯­éŸ³åˆæˆ
POST /api/voice/synthesize
Body: {
  text: string
  voice?: string
  speed?: number
}
Response: {
  audioUrl: string
  duration: number
}
```

### 5. CADåˆ†æå™¨

#### åŠŸèƒ½æ¦‚è¿°
CADå›¾çº¸è§£æã€å®‰é˜²è®¾å¤‡è¯†åˆ«ã€å¸ƒå±€åˆ†æ

#### æ ¸å¿ƒç»„ä»¶
- **CADAnalyzerContainer** - [components/cad-analyzer/cad-analyzer-container.tsx](mdc:components/cad-analyzer/cad-analyzer-container.tsx)

#### APIæ¥å£
```typescript
// åˆ†æCADæ–‡ä»¶
POST /api/cad/analyze
Body: {
  fileId: string
  analysisType: 'layout' | 'devices' | 'full'
}
Response: {
  analysisId: string
  status: 'processing' | 'completed' | 'failed'
  result?: CADAnalysisResult
}

// è·å–åˆ†æç»“æœ
GET /api/cad/analysis/:analysisId
Response: CADAnalysisResult
```

#### æ•°æ®æ¨¡å‹
```typescript
interface CADAnalysisResult {
  id: string
  fileName: string
  analysisType: string
  devices: Device[]
  layout: LayoutInfo
  recommendations: string[]
  confidence: number
  timestamp: Date
}
```

### 6. å›¾åƒç¼–è¾‘å™¨

#### åŠŸèƒ½æ¦‚è¿°
AIé©±åŠ¨çš„å›¾åƒç¼–è¾‘ã€å¤„ç†ã€ä¼˜åŒ–

#### æ ¸å¿ƒç»„ä»¶
- **ImageEditor** - [components/image-editor/image-editor.tsx](mdc:components/image-editor/image-editor.tsx)
- **ImageCanvas** - [components/image-editor/image-canvas.tsx](mdc:components/image-editor/image-canvas.tsx)

#### APIæ¥å£
```typescript
// ç¼–è¾‘å›¾åƒ
POST /api/image/edit
Body: {
  imageId: string
  operations: ImageOperation[]
}
Response: {
  editedImageId: string
  url: string
}

// è·å–ç¼–è¾‘å†å²
GET /api/image/history/:imageId
Response: ImageEditHistory[]
```

### 7. ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ

#### åŠŸèƒ½æ¦‚è¿°
ç”¨æˆ·è®¤è¯ã€æˆæƒã€æƒé™æ§åˆ¶

#### æ ¸å¿ƒç»„ä»¶
- **UserContext** - [context/user-context.tsx](mdc:context/user-context.tsx)
- **AuthGuard** - [components/auth-guard.tsx](mdc:components/auth-guard.tsx)

#### APIæ¥å£
```typescript
// ç”¨æˆ·ç™»å½•
POST /api/auth/login
Body: {
  email: string
  password: string
}
Response: {
  token: string
  user: User
  expiresIn: number
}

// ç”¨æˆ·æ³¨å†Œ
POST /api/auth/register
Body: {
  email: string
  password: string
  name: string
}
Response: {
  token: string
  user: User
}

// è·å–ç”¨æˆ·ä¿¡æ¯
GET /api/auth/me
Headers: { Authorization: 'Bearer <token>' }
Response: User
```

### 8. ç®¡ç†å‘˜ç³»ç»Ÿ

#### åŠŸèƒ½æ¦‚è¿°
ç³»ç»Ÿç®¡ç†ã€ç›‘æ§ã€é…ç½®

#### æ ¸å¿ƒç»„ä»¶
- **AdminDashboard** - [app/admin/page.tsx](mdc:app/admin/page.tsx)
- **AgentManagement** - [app/admin/agents/page.tsx](mdc:app/admin/agents/page.tsx)
- **UserManagement** - [app/admin/users/page.tsx](mdc:app/admin/users/page.tsx)

#### APIæ¥å£
```typescript
// è·å–ç³»ç»Ÿç»Ÿè®¡
GET /api/admin/stats
Response: {
  totalUsers: number
  totalAgents: number
  totalConversations: number
  systemHealth: SystemHealth
}

// è·å–ç³»ç»Ÿæ—¥å¿—
GET /api/admin/logs
Query: {
  level?: 'info' | 'warn' | 'error'
  startDate?: string
  endDate?: string
  limit?: number
}
Response: LogEntry[]
```

## ğŸ”§ é…ç½®ç®¡ç†

### ç¯å¢ƒé…ç½®
- **å¼€å‘ç¯å¢ƒ**: `.env.local`
- **æµ‹è¯•ç¯å¢ƒ**: `.env.test`
- **ç”Ÿäº§ç¯å¢ƒ**: `.env.production`

### é…ç½®æ–‡ä»¶
- **æ™ºèƒ½ä½“é…ç½®**: [config/default-agents.ts](mdc:config/default-agents.ts)
- **æ•°æ®åº“é…ç½®**: [config/config.json](mdc:config/config.json)
- **CADåˆ†æå™¨é…ç½®**: [config/cad-analyzer-config.json](mdc:config/cad-analyzer-config.json)

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å…³é”®æŒ‡æ ‡
- **å“åº”æ—¶é—´**: APIå“åº”æ—¶é—´ < 500ms
- **å¹¶å‘æ•°**: æ”¯æŒ1000+å¹¶å‘ç”¨æˆ·
- **å¯ç”¨æ€§**: 99.9%å¯ç”¨æ€§
- **é”™è¯¯ç‡**: < 0.1%é”™è¯¯ç‡

### ç›‘æ§ç«¯ç‚¹
```typescript
// å¥åº·æ£€æŸ¥
GET /api/health
Response: {
  status: 'healthy' | 'unhealthy'
  timestamp: string
  services: ServiceStatus[]
}

// æ€§èƒ½æŒ‡æ ‡
GET /api/metrics
Response: {
  responseTime: number
  memoryUsage: number
  cpuUsage: number
  activeConnections: number
}
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### è®¤è¯æˆæƒ
- **JWTä»¤ç‰Œ**: åŸºäºJWTçš„ç”¨æˆ·è®¤è¯
- **è§’è‰²æƒé™**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **APIå¯†é’¥**: æ™ºèƒ½ä½“APIå¯†é’¥ç®¡ç†

### æ•°æ®ä¿æŠ¤
- **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„è¾“å…¥éªŒè¯å’Œè¿‡æ»¤
- **è¾“å‡ºç¼–ç **: é˜²æ­¢XSSæ”»å‡»
- **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢

## ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ

### å“åº”å¼è®¾è®¡
- **æ–­ç‚¹**: sm(640px), md(768px), lg(1024px), xl(1280px)
- **ç§»åŠ¨ä¼˜åŒ–**: è§¦æ‘¸å‹å¥½çš„ç•Œé¢è®¾è®¡
- **PWAæ”¯æŒ**: æ¸è¿›å¼Webåº”ç”¨åŠŸèƒ½

### ç§»åŠ¨ç«¯ç»„ä»¶
- **MobileNav** - [components/mobile-nav.tsx](mdc:components/mobile-nav.tsx)
- **ResponsiveContainer** - [components/responsive-container.tsx](mdc:components/responsive-container.tsx)

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜
1. **æ™ºèƒ½ä½“æ— å“åº”**: æ£€æŸ¥APIé…ç½®å’Œç½‘ç»œè¿æ¥
2. **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**: æ£€æŸ¥æ–‡ä»¶å¤§å°å’Œæ ¼å¼
3. **è¯­éŸ³è¯†åˆ«ä¸å‡†ç¡®**: æ£€æŸ¥éº¦å…‹é£æƒé™å’Œç½‘ç»œè´¨é‡

### é”™è¯¯ä»£ç 
- **400**: è¯·æ±‚å‚æ•°é”™è¯¯
- **401**: æœªæˆæƒè®¿é—®
- **403**: æƒé™ä¸è¶³
- **404**: èµ„æºä¸å­˜åœ¨
- **500**: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**è®°ä½: æ‰€æœ‰åŠŸèƒ½éƒ½å¿…é¡»ç»è¿‡å……åˆ†æµ‹è¯•æ‰èƒ½ä¸Šçº¿ï¼**