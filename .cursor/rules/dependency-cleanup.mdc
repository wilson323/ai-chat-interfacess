# ä¾èµ–æ¸…ç†è§„èŒƒ

## ğŸ¯ ä¾èµ–ç®¡ç†åŸåˆ™

### 1. ä¾èµ–æ¸…ç†ç›®æ ‡
- **é›¶å†—ä½™**: æ¶ˆé™¤æ‰€æœ‰æœªä½¿ç”¨çš„ä¾èµ–
- **æœ€å°åŒ–**: åªä¿ç•™å¿…è¦çš„ä¾èµ–
- **ç‰ˆæœ¬ç»Ÿä¸€**: ç¡®ä¿ä¾èµ–ç‰ˆæœ¬ä¸€è‡´æ€§
- **å®‰å…¨ä¼˜å…ˆ**: å®šæœŸæ›´æ–°ä¾èµ–ï¼Œä¿®å¤å®‰å…¨æ¼æ´

### 2. ä¾èµ–åˆ†ç±»ç®¡ç†
- **ç”Ÿäº§ä¾èµ–**: è¿è¡Œæ—¶å¿…éœ€çš„ä¾èµ–
- **å¼€å‘ä¾èµ–**: å¼€å‘æ—¶ä½¿ç”¨çš„ä¾èµ–
- **å¯¹ç­‰ä¾èµ–**: éœ€è¦å®¿ä¸»ç¯å¢ƒæä¾›çš„ä¾èµ–
- **å¯é€‰ä¾èµ–**: å¯é€‰çš„å¢å¼ºåŠŸèƒ½ä¾èµ–

## ğŸ“‹ ä¾èµ–æ¸…ç†è§„èŒƒ

### 1. å¯¼å…¥æ¸…ç†æ ‡å‡†

#### å¯¼å…¥é¡ºåºè§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„å¯¼å…¥é¡ºåº
// 1. Reactç›¸å…³
import React, { useState, useEffect, useCallback } from 'react'

// 2. Next.jsç›¸å…³
import { NextPage, GetServerSideProps } from 'next'
import { useRouter } from 'next/router'

// 3. ç¬¬ä¸‰æ–¹åº“ (æŒ‰å­—æ¯é¡ºåº)
import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'
import { toast } from 'react-hot-toast'

// 4. å†…éƒ¨æ¨¡å— (æŒ‰è·¯å¾„æ·±åº¦)
import { useAuth } from '@/hooks/useAuth'
import { UserService } from '@/lib/services/user-service'
import { formatDate } from '@/lib/utils/date-utils'

// 5. ç±»å‹å¯¼å…¥
import type { User, UserProps } from '@/types/user'
```

#### é‡å¤å¯¼å…¥æ¸…ç†
```typescript
// âŒ ä¸å¥½çš„å¯¼å…¥ - é‡å¤å¯¼å…¥
import React, { useState, useEffect, useState } from 'react' // é‡å¤å¯¼å…¥useState
import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button' // é‡å¤å¯¼å…¥Button

// âœ… å¥½çš„å¯¼å…¥ - æ— é‡å¤
import React, { useState, useEffect } from 'react'
import { Button, Card } from '@/components/ui'
```

#### æœªä½¿ç”¨å¯¼å…¥æ¸…ç†
```typescript
// âŒ ä¸å¥½çš„å¯¼å…¥ - æœªä½¿ç”¨çš„å¯¼å…¥
import React, { useState, useEffect, useCallback } from 'react'
import { Button, Card, Input } from '@/components/ui' // Inputæœªä½¿ç”¨
import { useAuth } from '@/hooks/useAuth' // useAuthæœªä½¿ç”¨
import { formatDate } from '@/lib/utils/date-utils' // formatDateæœªä½¿ç”¨

// âœ… å¥½çš„å¯¼å…¥ - åªå¯¼å…¥ä½¿ç”¨çš„
import React, { useState, useEffect } from 'react'
import { Button, Card } from '@/components/ui'
```

### 2. ä¾èµ–åŒ…æ¸…ç†

#### package.jsonæ¸…ç†
```json
{
  "dependencies": {
    // âœ… ç”Ÿäº§ä¾èµ– - è¿è¡Œæ—¶å¿…éœ€
    "next": "15.2.4",
    "react": "18.2.0",
    "react-dom": "18.2.0",
    "typescript": "5.0.0",
    "postgresql": "3.0.0",
    "sequelize": "6.35.0"
  },
  "devDependencies": {
    // âœ… å¼€å‘ä¾èµ– - å¼€å‘æ—¶ä½¿ç”¨
    "@types/react": "18.2.0",
    "@types/node": "20.0.0",
    "eslint": "8.0.0",
    "prettier": "3.0.0",
    "jest": "29.0.0",
    "playwright": "1.40.0"
  },
  "peerDependencies": {
    // âœ… å¯¹ç­‰ä¾èµ– - éœ€è¦å®¿ä¸»ç¯å¢ƒæä¾›
    "react": ">=18.0.0",
    "react-dom": ">=18.0.0"
  }
}
```

#### ä¾èµ–ç‰ˆæœ¬ç®¡ç†
```json
{
  "dependencies": {
    // âœ… å›ºå®šç‰ˆæœ¬ - ç¡®ä¿ä¸€è‡´æ€§
    "next": "15.2.4",
    "react": "18.2.0",
    
    // âœ… èŒƒå›´ç‰ˆæœ¬ - å…è®¸è¡¥ä¸æ›´æ–°
    "typescript": "~5.0.0",
    "eslint": "^8.0.0",
    
    // âŒ é¿å… - è¿‡äºå®½æ³›çš„ç‰ˆæœ¬èŒƒå›´
    "some-package": "*",
    "another-package": ">=1.0.0"
  }
}
```

### 3. ä»£ç æ¸…ç†æ ‡å‡†

#### æœªä½¿ç”¨å˜é‡æ¸…ç†
```typescript
// âŒ ä¸å¥½çš„ä»£ç  - æœªä½¿ç”¨çš„å˜é‡
function processUserData(userData: UserData) {
  const processedData = userData // æœªä½¿ç”¨
  const tempData = userData.name // æœªä½¿ç”¨
  const result = userData.id // æœªä½¿ç”¨
  
  return userData
}

// âœ… å¥½çš„ä»£ç  - æ¸…ç†æœªä½¿ç”¨å˜é‡
function processUserData(userData: UserData) {
  return userData
}
```

#### æœªä½¿ç”¨å‡½æ•°æ¸…ç†
```typescript
// âŒ ä¸å¥½çš„ä»£ç  - æœªä½¿ç”¨çš„å‡½æ•°
function unusedFunction() {
  return 'unused'
}

function processData(data: any) {
  // å®é™…ä½¿ç”¨çš„å‡½æ•°
  return data
}

// âœ… å¥½çš„ä»£ç  - åˆ é™¤æœªä½¿ç”¨å‡½æ•°
function processData(data: any) {
  return data
}
```

#### æœªä½¿ç”¨ç±»å‹æ¸…ç†
```typescript
// âŒ ä¸å¥½çš„ä»£ç  - æœªä½¿ç”¨çš„ç±»å‹
interface UnusedInterface {
  name: string
  age: number
}

interface UsedInterface {
  id: string
  value: string
}

// âœ… å¥½çš„ä»£ç  - åˆ é™¤æœªä½¿ç”¨ç±»å‹
interface UsedInterface {
  id: string
  value: string
}
```

## ğŸ› ï¸ ä¾èµ–æ¸…ç†å·¥å…·

### 1. ESLinté…ç½®
```json
{
  "rules": {
    "no-unused-vars": "error",
    "no-unused-imports": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-unused-imports": "error",
    "import/no-unused-modules": "error"
  }
}
```

### 2. ä¾èµ–æ£€æŸ¥è„šæœ¬
```typescript
// scripts/check-dependencies.ts
import { execSync } from 'child_process'
import fs from 'fs'
import path from 'path'

interface DependencyInfo {
  name: string
  version: string
  used: boolean
  files: string[]
}

class DependencyChecker {
  private packageJson: any
  private dependencies: DependencyInfo[] = []

  constructor() {
    this.packageJson = JSON.parse(
      fs.readFileSync('package.json', 'utf-8')
    )
    this.loadDependencies()
  }

  private loadDependencies() {
    const allDeps = {
      ...this.packageJson.dependencies,
      ...this.packageJson.devDependencies
    }

    this.dependencies = Object.entries(allDeps).map(([name, version]) => ({
      name,
      version: version as string,
      used: false,
      files: []
    }))
  }

  async checkUsage() {
    console.log('ğŸ” æ£€æŸ¥ä¾èµ–ä½¿ç”¨æƒ…å†µ...')
    
    for (const dep of this.dependencies) {
      const usage = await this.findUsage(dep.name)
      dep.used = usage.length > 0
      dep.files = usage
    }

    this.reportResults()
  }

  private async findUsage(depName: string): Promise<string[]> {
    try {
      const result = execSync(
        `grep -r "from ['\"]${depName}['\"]" src/ --include="*.ts" --include="*.tsx" || true`,
        { encoding: 'utf-8' }
      )
      return result.trim().split('\n').filter(line => line.length > 0)
    } catch {
      return []
    }
  }

  private reportResults() {
    const unused = this.dependencies.filter(dep => !dep.used)
    
    if (unused.length === 0) {
      console.log('âœ… æ‰€æœ‰ä¾èµ–éƒ½åœ¨ä½¿ç”¨ä¸­')
      return
    }

    console.log('âŒ å‘ç°æœªä½¿ç”¨çš„ä¾èµ–:')
    unused.forEach(dep => {
      console.log(`  - ${dep.name}@${dep.version}`)
    })

    console.log('\nå»ºè®®æ“ä½œ:')
    console.log('1. æ£€æŸ¥è¿™äº›ä¾èµ–æ˜¯å¦çœŸçš„ä¸éœ€è¦')
    console.log('2. å¦‚æœä¸éœ€è¦ï¼Œè¯·ä»package.jsonä¸­ç§»é™¤')
    console.log('3. è¿è¡Œ npm install æ›´æ–°ä¾èµ–')
  }
}

// è¿è¡Œæ£€æŸ¥
new DependencyChecker().checkUsage()
```

### 3. è‡ªåŠ¨æ¸…ç†è„šæœ¬
```typescript
// scripts/cleanup-dependencies.ts
import { execSync } from 'child_process'
import fs from 'fs'

class DependencyCleanup {
  async cleanup() {
    console.log('ğŸ§¹ å¼€å§‹æ¸…ç†ä¾èµ–...')
    
    // 1. æ¸…ç†node_modules
    await this.cleanNodeModules()
    
    // 2. æ¸…ç†package-lock.json
    await this.cleanPackageLock()
    
    // 3. é‡æ–°å®‰è£…ä¾èµ–
    await this.reinstallDependencies()
    
    // 4. æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–
    await this.checkUnusedDependencies()
    
    console.log('âœ… ä¾èµ–æ¸…ç†å®Œæˆ')
  }

  private async cleanNodeModules() {
    console.log('ğŸ—‘ï¸ æ¸…ç†node_modules...')
    try {
      execSync('rm -rf node_modules', { stdio: 'inherit' })
    } catch (error) {
      console.error('æ¸…ç†node_moduleså¤±è´¥:', error)
    }
  }

  private async cleanPackageLock() {
    console.log('ğŸ—‘ï¸ æ¸…ç†package-lock.json...')
    try {
      execSync('rm -f package-lock.json', { stdio: 'inherit' })
    } catch (error) {
      console.error('æ¸…ç†package-lock.jsonå¤±è´¥:', error)
    }
  }

  private async reinstallDependencies() {
    console.log('ğŸ“¦ é‡æ–°å®‰è£…ä¾èµ–...')
    try {
      execSync('npm install', { stdio: 'inherit' })
    } catch (error) {
      console.error('é‡æ–°å®‰è£…ä¾èµ–å¤±è´¥:', error)
    }
  }

  private async checkUnusedDependencies() {
    console.log('ğŸ” æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–...')
    try {
      execSync('npx depcheck', { stdio: 'inherit' })
    } catch (error) {
      console.error('æ£€æŸ¥æœªä½¿ç”¨ä¾èµ–å¤±è´¥:', error)
    }
  }
}

// è¿è¡Œæ¸…ç†
new DependencyCleanup().cleanup()
```

## ğŸ“Š ä¾èµ–è´¨é‡æŒ‡æ ‡

### ä¾èµ–è´¨é‡è¦æ±‚
- **æœªä½¿ç”¨ä¾èµ–ç‡**: ç›®æ ‡ 0%
- **é‡å¤ä¾èµ–ç‡**: ç›®æ ‡ 0%
- **è¿‡æ—¶ä¾èµ–ç‡**: ç›®æ ‡ < 10%
- **å®‰å…¨æ¼æ´æ•°**: ç›®æ ‡ 0

### æ£€æŸ¥å‘½ä»¤
```bash
# æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–
npm run check:dependencies

# æ¸…ç†ä¾èµ–
npm run clean:dependencies

# æ›´æ–°ä¾èµ–
npm run update:dependencies

# å®‰å…¨å®¡è®¡
npm audit

# ä¿®å¤å®‰å…¨æ¼æ´
npm audit fix
```

## ğŸ”§ ä¾èµ–ç®¡ç†æœ€ä½³å®è·µ

### 1. ä¾èµ–é€‰æ‹©åŸåˆ™
```typescript
// âœ… ä¼˜å…ˆé€‰æ‹©
// 1. å®˜æ–¹ç»´æŠ¤çš„åŒ…
import { Button } from '@mui/material' // å®˜æ–¹UIåº“

// 2. ç¤¾åŒºæ´»è·ƒçš„åŒ…
import { z } from 'zod' // æ´»è·ƒçš„éªŒè¯åº“

// 3. ç±»å‹æ”¯æŒå¥½çš„åŒ…
import { PrismaClient } from '@prisma/client' // ç±»å‹å®‰å…¨

// âŒ é¿å…é€‰æ‹©
// 1. é•¿æ—¶é—´æœªæ›´æ–°çš„åŒ…
// 2. å®‰å…¨æ¼æ´å¤šçš„åŒ…
// 3. åŠŸèƒ½é‡å¤çš„åŒ…
```

### 2. ä¾èµ–ç‰ˆæœ¬ç®¡ç†
```json
{
  "dependencies": {
    // âœ… ç”Ÿäº§ä¾èµ– - å›ºå®šç‰ˆæœ¬
    "next": "15.2.4",
    "react": "18.2.0",
    
    // âœ… å·¥å…·åº“ - èŒƒå›´ç‰ˆæœ¬
    "lodash": "^4.17.21",
    "moment": "~2.29.4"
  },
  "devDependencies": {
    // âœ… å¼€å‘å·¥å…· - æœ€æ–°ç‰ˆæœ¬
    "eslint": "^8.0.0",
    "prettier": "^3.0.0"
  }
}
```

### 3. ä¾èµ–æ›´æ–°ç­–ç•¥
```bash
# 1. æ£€æŸ¥è¿‡æ—¶çš„ä¾èµ–
npm outdated

# 2. æ›´æ–°è¡¥ä¸ç‰ˆæœ¬
npm update

# 3. æ›´æ–°æ¬¡è¦ç‰ˆæœ¬
npm install package@latest

# 4. æ›´æ–°ä¸»è¦ç‰ˆæœ¬ï¼ˆè°¨æ…ï¼‰
npm install package@^2.0.0
```

## ğŸ“‹ ä¾èµ–æ¸…ç†æ£€æŸ¥æ¸…å•

### ä»£ç æ¸…ç†æ£€æŸ¥
- [ ] åˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥
- [ ] åˆ é™¤æœªä½¿ç”¨çš„å˜é‡
- [ ] åˆ é™¤æœªä½¿ç”¨çš„å‡½æ•°
- [ ] åˆ é™¤æœªä½¿ç”¨çš„ç±»å‹
- [ ] åˆ é™¤æœªä½¿ç”¨çš„å¸¸é‡

### ä¾èµ–åŒ…æ¸…ç†æ£€æŸ¥
- [ ] åˆ é™¤æœªä½¿ç”¨çš„ä¾èµ–åŒ…
- [ ] åˆå¹¶é‡å¤çš„ä¾èµ–åŒ…
- [ ] æ›´æ–°è¿‡æ—¶çš„ä¾èµ–åŒ…
- [ ] ä¿®å¤å®‰å…¨æ¼æ´
- [ ] ä¼˜åŒ–ä¾èµ–ç‰ˆæœ¬èŒƒå›´

### é…ç½®æ–‡ä»¶æ¸…ç†æ£€æŸ¥
- [ ] æ¸…ç†package.json
- [ ] æ¸…ç†tsconfig.json
- [ ] æ¸…ç†eslinté…ç½®
- [ ] æ¸…ç†prettieré…ç½®
- [ ] æ¸…ç†å…¶ä»–é…ç½®æ–‡ä»¶

## âš ï¸ é‡è¦æé†’

1. **å®šæœŸæ¸…ç†**: æ¯å‘¨è¿›è¡Œä¸€æ¬¡ä¾èµ–æ¸…ç†
2. **å®‰å…¨ä¼˜å…ˆ**: åŠæ—¶ä¿®å¤å®‰å…¨æ¼æ´
3. **ç‰ˆæœ¬æ§åˆ¶**: è°¨æ…æ›´æ–°ä¸»è¦ç‰ˆæœ¬
4. **æµ‹è¯•éªŒè¯**: æ›´æ–°ä¾èµ–åå¿…é¡»æµ‹è¯•
5. **æ–‡æ¡£åŒæ­¥**: ä¾èµ–å˜æ›´å¿…é¡»æ›´æ–°æ–‡æ¡£

**è®°ä½: ä¿æŒä¾èµ–çš„æ¸…æ´å’Œæœ€æ–°æ˜¯é¡¹ç›®å¥åº·çš„é‡è¦ä¿éšœã€‚**