---
alwaysApply: true
---

# çŠ¶æ€ç®¡ç†æ ‡å‡†è§„èŒƒ

## ğŸ¯ çŠ¶æ€ç®¡ç†åŸåˆ™

### 1. ç»Ÿä¸€çŠ¶æ€ç®¡ç†
- **å•ä¸€æ•°æ®æº**: ä½¿ç”¨ Zustand ä½œä¸ºå…¨å±€çŠ¶æ€ç®¡ç†
- **çŠ¶æ€åˆ†å±‚**: å…¨å±€çŠ¶æ€ã€ç»„ä»¶çŠ¶æ€ã€æœåŠ¡çŠ¶æ€åˆ†ç¦»
- **çŠ¶æ€åŒæ­¥**: è‡ªåŠ¨åŒæ­¥æœåŠ¡ç«¯çŠ¶æ€å’Œå®¢æˆ·ç«¯çŠ¶æ€
- **çŠ¶æ€æŒä¹…åŒ–**: å…³é”®çŠ¶æ€æŒä¹…åŒ–åˆ° localStorage

### 2. æ€§èƒ½ä¼˜åŒ–
- **ç²¾ç¡®è®¢é˜…**: ä½¿ç”¨é€‰æ‹©å™¨ç²¾ç¡®è®¢é˜…éœ€è¦çš„çŠ¶æ€ç‰‡æ®µ
- **çŠ¶æ€åˆ†ç‰‡**: æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†çŠ¶æ€ï¼Œé¿å…å¤§å¯¹è±¡
- **çŠ¶æ€ç¼“å­˜**: ä½¿ç”¨ TanStack Query ç¼“å­˜æœåŠ¡ç«¯çŠ¶æ€
- **çŠ¶æ€æ›´æ–°ä¼˜åŒ–**: ä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°

### 3. ç±»å‹å®‰å…¨
- **å®Œæ•´ç±»å‹å®šä¹‰**: æ‰€æœ‰çŠ¶æ€éƒ½æœ‰å®Œæ•´çš„ TypeScript ç±»å‹
- **ç±»å‹çº¦æŸ**: ä½¿ç”¨ç±»å‹çº¦æŸç¡®ä¿çŠ¶æ€æ›´æ–°å®‰å…¨
- **ç±»å‹æ¨å¯¼**: åˆ©ç”¨ TypeScript ç±»å‹æ¨å¯¼å‡å°‘é‡å¤ä»£ç 

## ğŸ—ï¸ çŠ¶æ€ç®¡ç†æ¶æ„

### 1. çŠ¶æ€åˆ†å±‚
```typescript
// å…¨å±€çŠ¶æ€ - Zustand
const useAppStore = create<AppState>()

// æœåŠ¡çŠ¶æ€ - TanStack Query
const { data: agents } = useQuery(['agents'], fetchAgents)

// ç»„ä»¶çŠ¶æ€ - useState
const [localState, setLocalState] = useState()
```

### 2. çŠ¶æ€é€‰æ‹©å™¨
```typescript
// ç²¾ç¡®è®¢é˜…ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const user = useAppStore((state) => state.user)
const userActions = useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))

// ä½¿ç”¨é¢„å®šä¹‰é€‰æ‹©å™¨
const { user, userActions } = useStableSelectors()
```

### 3. çŠ¶æ€åŒæ­¥
```typescript
// è‡ªåŠ¨åŒæ­¥æœåŠ¡ç«¯çŠ¶æ€
const useAgentSync = () => {
  const { data: agents } = useAgents()
  const setAgents = useAppStore((state) => state.setAgents)
  
  useEffect(() => {
    if (agents) {
      setAgents(agents)
    }
  }, [agents, setAgents])
}
```

## ğŸ“¦ çŠ¶æ€ç®¡ç†å·¥å…·

### 1. Zustand Store
```typescript
// lib/store/appStore.ts
export const useAppStore = create<AppState>()(
  persist(
    immer((set, get) => ({
      // çŠ¶æ€å®šä¹‰
      user: { id: null, name: null },
      
      // æ“ä½œæ–¹æ³•
      setUser: (user) => set((state) => {
        Object.assign(state.user, user)
      })
    })),
    {
      name: 'app-storage',
      storage: createJSONStorage(() => localStorage)
    }
  )
)
```

### 2. çŠ¶æ€é€‰æ‹©å™¨
```typescript
// lib/store/selectors.ts
export const useUser = () => useAppStore((state) => state.user)
export const useUserActions = () => useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))
```

### 3. æœåŠ¡çŠ¶æ€ç®¡ç†
```typescript
// lib/hooks/useAgents.ts
export const useAgents = () => {
  return useQuery({
    queryKey: ['agents'],
    queryFn: fetchAgents,
    staleTime: 5 * 60 * 1000
  })
}
```

## ğŸ”§ çŠ¶æ€ç®¡ç†è§„èŒƒ

### 1. çŠ¶æ€å®šä¹‰è§„èŒƒ
```typescript
/**
 * åº”ç”¨çŠ¶æ€æ¥å£
 * åŒ…å«æ‰€æœ‰å…¨å±€çŠ¶æ€å’Œæ“ä½œæ–¹æ³•
 */
interface AppState {
  // çŠ¶æ€å®šä¹‰
  user: UserState
  agents: AgentState
  ui: UIState
  
  // æ“ä½œæ–¹æ³•
  setUser: (user: Partial<UserState>) => void
  setAgents: (agents: Agent[]) => void
}
```

### 2. çŠ¶æ€æ›´æ–°è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„çŠ¶æ€æ›´æ–° - ä½¿ç”¨ Immer
setUser: (user) => set((state) => {
  Object.assign(state.user, user)
})

// âŒ é”™è¯¯çš„çŠ¶æ€æ›´æ–° - ç›´æ¥ä¿®æ”¹
setUser: (user) => set((state) => {
  state.user = user // é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€
})
```

### 3. çŠ¶æ€è®¢é˜…è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„çŠ¶æ€è®¢é˜… - ç²¾ç¡®è®¢é˜…
const user = useAppStore((state) => state.user)
const userActions = useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))

// âŒ é”™è¯¯çš„çŠ¶æ€è®¢é˜… - è®¢é˜…æ•´ä¸ªçŠ¶æ€
const state = useAppStore() // é”™è¯¯ï¼šè®¢é˜…æ•´ä¸ªçŠ¶æ€
```

### 4. çŠ¶æ€åŒæ­¥è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„çŠ¶æ€åŒæ­¥ - ä½¿ç”¨ useEffect
const useAgentSync = () => {
  const { data: agents } = useAgents()
  const setAgents = useAppStore((state) => state.setAgents)
  
  useEffect(() => {
    if (agents) {
      setAgents(agents)
    }
  }, [agents, setAgents])
}

// âŒ é”™è¯¯çš„çŠ¶æ€åŒæ­¥ - åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨
const MyComponent = () => {
  const { data: agents } = useAgents()
  const setAgents = useAppStore((state) => state.setAgents)
  
  // é”™è¯¯ï¼šåœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨
  if (agents) {
    setAgents(agents)
  }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. çŠ¶æ€é€‰æ‹©å™¨ä¼˜åŒ–
```typescript
// ä½¿ç”¨é€‰æ‹©å™¨é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const useUser = () => useAppStore((state) => state.user)
const useUserActions = () => useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))

// ä½¿ç”¨ç¨³å®šçš„é€‰æ‹©å™¨
const useStableSelectors = () => {
  const user = useUser()
  const userActions = useUserActions()
  
  return { user, userActions }
}
```

### 2. çŠ¶æ€åˆ†ç‰‡ä¼˜åŒ–
```typescript
// æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†çŠ¶æ€
const useAgentState = () => useAppStore((state) => state.agents)
const useUIState = () => useAppStore((state) => state.ui)
const useChatState = () => useAppStore((state) => state.chat)
```

### 3. çŠ¶æ€ç¼“å­˜ä¼˜åŒ–
```typescript
// ä½¿ç”¨ TanStack Query ç¼“å­˜æœåŠ¡ç«¯çŠ¶æ€
const { data: agents, isLoading } = useQuery({
  queryKey: ['agents'],
  queryFn: fetchAgents,
  staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿå†…æ•°æ®è¢«è®¤ä¸ºæ˜¯æ–°é²œçš„
  cacheTime: 10 * 60 * 1000 // 10åˆ†é’Ÿåæ¸…ç†ç¼“å­˜
})
```

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### 1. çŠ¶æ€æµ‹è¯•
```typescript
// __tests__/store/appStore.test.ts
describe('AppStore', () => {
  it('åº”è¯¥æ­£ç¡®è®¾ç½®ç”¨æˆ·ä¿¡æ¯', () => {
    const { result } = renderHook(() => useAppStore())
    
    act(() => {
      result.current.setUser({ id: '1', name: 'Test User' })
    })
    
    expect(result.current.user.id).toBe('1')
    expect(result.current.user.name).toBe('Test User')
  })
})
```

### 2. é€‰æ‹©å™¨æµ‹è¯•
```typescript
// __tests__/store/selectors.test.ts
describe('Selectors', () => {
  it('åº”è¯¥é€‰æ‹©ç”¨æˆ·çŠ¶æ€', () => {
    const { result } = renderHook(() => useUser())
    expect(result.current).toBeDefined()
  })
})
```

### 3. æ€§èƒ½æµ‹è¯•
```typescript
// __tests__/store/performance.test.ts
describe('Performance', () => {
  it('åº”è¯¥æ”¯æŒå¤§é‡çŠ¶æ€æ›´æ–°', () => {
    const { result } = renderHook(() => useAppStore())
    const startTime = performance.now()
    
    act(() => {
      for (let i = 0; i < 1000; i++) {
        result.current.setGlobalVariable(`key${i}`, `value${i}`)
      }
    })
    
    const endTime = performance.now()
    expect(endTime - startTime).toBeLessThan(100)
  })
})
```

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### çŠ¶æ€å®šä¹‰æ£€æŸ¥
- [ ] çŠ¶æ€æ¥å£å®Œæ•´å®šä¹‰
- [ ] çŠ¶æ€ç±»å‹å®‰å…¨
- [ ] çŠ¶æ€é»˜è®¤å€¼è®¾ç½®
- [ ] çŠ¶æ€éªŒè¯è§„åˆ™

### çŠ¶æ€æ›´æ–°æ£€æŸ¥
- [ ] ä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°
- [ ] çŠ¶æ€æ›´æ–°é€»è¾‘æ­£ç¡®
- [ ] çŠ¶æ€æ›´æ–°æ€§èƒ½ä¼˜åŒ–
- [ ] çŠ¶æ€æ›´æ–°é”™è¯¯å¤„ç†

### çŠ¶æ€è®¢é˜…æ£€æŸ¥
- [ ] ä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨
- [ ] é¿å…è®¢é˜…æ•´ä¸ªçŠ¶æ€
- [ ] çŠ¶æ€è®¢é˜…æ€§èƒ½ä¼˜åŒ–
- [ ] çŠ¶æ€è®¢é˜…æ¸…ç†

### çŠ¶æ€åŒæ­¥æ£€æŸ¥
- [ ] æœåŠ¡ç«¯çŠ¶æ€åŒæ­¥
- [ ] æœ¬åœ°çŠ¶æ€æŒä¹…åŒ–
- [ ] çŠ¶æ€åŒæ­¥é”™è¯¯å¤„ç†
- [ ] çŠ¶æ€åŒæ­¥æ€§èƒ½ä¼˜åŒ–

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **çŠ¶æ€æ›´æ–°**: å§‹ç»ˆä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°
2. **çŠ¶æ€è®¢é˜…**: ä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
3. **çŠ¶æ€åŒæ­¥**: ä½¿ç”¨ useEffect è¿›è¡ŒçŠ¶æ€åŒæ­¥
4. **çŠ¶æ€æµ‹è¯•**: ç¡®ä¿çŠ¶æ€ç®¡ç†é€»è¾‘æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–
5. **æ€§èƒ½ç›‘æ§**: æŒç»­ç›‘æ§çŠ¶æ€æ›´æ–°æ€§èƒ½

## ğŸ¯ æœ€ä½³å®è·µ

### 1. çŠ¶æ€è®¾è®¡
- æŒ‰åŠŸèƒ½æ¨¡å—è®¾è®¡çŠ¶æ€ç»“æ„
- ä½¿ç”¨æ‰å¹³åŒ–çŠ¶æ€ç»“æ„
- é¿å…æ·±å±‚åµŒå¥—çŠ¶æ€

### 2. çŠ¶æ€æ›´æ–°
- ä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°
- æ‰¹é‡æ›´æ–°ç›¸å…³çŠ¶æ€
- é¿å…é¢‘ç¹çš„çŠ¶æ€æ›´æ–°

### 3. çŠ¶æ€è®¢é˜…
- ä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨
- é¿å…è®¢é˜…æ•´ä¸ªçŠ¶æ€
- ä½¿ç”¨ç¨³å®šçš„é€‰æ‹©å™¨å¼•ç”¨

### 4. çŠ¶æ€åŒæ­¥
- ä½¿ç”¨ TanStack Query ç®¡ç†æœåŠ¡ç«¯çŠ¶æ€
- ä½¿ç”¨ useEffect è¿›è¡ŒçŠ¶æ€åŒæ­¥
- å¤„ç†çŠ¶æ€åŒæ­¥é”™è¯¯

**è®°ä½: å¥½çš„çŠ¶æ€ç®¡ç†æ˜¯åº”ç”¨æ€§èƒ½çš„åŸºç¡€ï¼Œç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ç¡®ä¿åº”ç”¨çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚**# çŠ¶æ€ç®¡ç†æ ‡å‡†è§„èŒƒ

## ğŸ¯ çŠ¶æ€ç®¡ç†åŸåˆ™

### 1. ç»Ÿä¸€çŠ¶æ€ç®¡ç†
- **å•ä¸€æ•°æ®æº**: ä½¿ç”¨ Zustand ä½œä¸ºå…¨å±€çŠ¶æ€ç®¡ç†
- **çŠ¶æ€åˆ†å±‚**: å…¨å±€çŠ¶æ€ã€ç»„ä»¶çŠ¶æ€ã€æœåŠ¡çŠ¶æ€åˆ†ç¦»
- **çŠ¶æ€åŒæ­¥**: è‡ªåŠ¨åŒæ­¥æœåŠ¡ç«¯çŠ¶æ€å’Œå®¢æˆ·ç«¯çŠ¶æ€
- **çŠ¶æ€æŒä¹…åŒ–**: å…³é”®çŠ¶æ€æŒä¹…åŒ–åˆ° localStorage

### 2. æ€§èƒ½ä¼˜åŒ–
- **ç²¾ç¡®è®¢é˜…**: ä½¿ç”¨é€‰æ‹©å™¨ç²¾ç¡®è®¢é˜…éœ€è¦çš„çŠ¶æ€ç‰‡æ®µ
- **çŠ¶æ€åˆ†ç‰‡**: æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†çŠ¶æ€ï¼Œé¿å…å¤§å¯¹è±¡
- **çŠ¶æ€ç¼“å­˜**: ä½¿ç”¨ TanStack Query ç¼“å­˜æœåŠ¡ç«¯çŠ¶æ€
- **çŠ¶æ€æ›´æ–°ä¼˜åŒ–**: ä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°

### 3. ç±»å‹å®‰å…¨
- **å®Œæ•´ç±»å‹å®šä¹‰**: æ‰€æœ‰çŠ¶æ€éƒ½æœ‰å®Œæ•´çš„ TypeScript ç±»å‹
- **ç±»å‹çº¦æŸ**: ä½¿ç”¨ç±»å‹çº¦æŸç¡®ä¿çŠ¶æ€æ›´æ–°å®‰å…¨
- **ç±»å‹æ¨å¯¼**: åˆ©ç”¨ TypeScript ç±»å‹æ¨å¯¼å‡å°‘é‡å¤ä»£ç 

## ğŸ—ï¸ çŠ¶æ€ç®¡ç†æ¶æ„

### 1. çŠ¶æ€åˆ†å±‚
```typescript
// å…¨å±€çŠ¶æ€ - Zustand
const useAppStore = create<AppState>()

// æœåŠ¡çŠ¶æ€ - TanStack Query
const { data: agents } = useQuery(['agents'], fetchAgents)

// ç»„ä»¶çŠ¶æ€ - useState
const [localState, setLocalState] = useState()
```

### 2. çŠ¶æ€é€‰æ‹©å™¨
```typescript
// ç²¾ç¡®è®¢é˜…ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const user = useAppStore((state) => state.user)
const userActions = useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))

// ä½¿ç”¨é¢„å®šä¹‰é€‰æ‹©å™¨
const { user, userActions } = useStableSelectors()
```

### 3. çŠ¶æ€åŒæ­¥
```typescript
// è‡ªåŠ¨åŒæ­¥æœåŠ¡ç«¯çŠ¶æ€
const useAgentSync = () => {
  const { data: agents } = useAgents()
  const setAgents = useAppStore((state) => state.setAgents)
  
  useEffect(() => {
    if (agents) {
      setAgents(agents)
    }
  }, [agents, setAgents])
}
```

## ğŸ“¦ çŠ¶æ€ç®¡ç†å·¥å…·

### 1. Zustand Store
```typescript
// lib/store/appStore.ts
export const useAppStore = create<AppState>()(
  persist(
    immer((set, get) => ({
      // çŠ¶æ€å®šä¹‰
      user: { id: null, name: null },
      
      // æ“ä½œæ–¹æ³•
      setUser: (user) => set((state) => {
        Object.assign(state.user, user)
      })
    })),
    {
      name: 'app-storage',
      storage: createJSONStorage(() => localStorage)
    }
  )
)
```

### 2. çŠ¶æ€é€‰æ‹©å™¨
```typescript
// lib/store/selectors.ts
export const useUser = () => useAppStore((state) => state.user)
export const useUserActions = () => useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))
```

### 3. æœåŠ¡çŠ¶æ€ç®¡ç†
```typescript
// lib/hooks/useAgents.ts
export const useAgents = () => {
  return useQuery({
    queryKey: ['agents'],
    queryFn: fetchAgents,
    staleTime: 5 * 60 * 1000
  })
}
```

## ğŸ”§ çŠ¶æ€ç®¡ç†è§„èŒƒ

### 1. çŠ¶æ€å®šä¹‰è§„èŒƒ
```typescript
/**
 * åº”ç”¨çŠ¶æ€æ¥å£
 * åŒ…å«æ‰€æœ‰å…¨å±€çŠ¶æ€å’Œæ“ä½œæ–¹æ³•
 */
interface AppState {
  // çŠ¶æ€å®šä¹‰
  user: UserState
  agents: AgentState
  ui: UIState
  
  // æ“ä½œæ–¹æ³•
  setUser: (user: Partial<UserState>) => void
  setAgents: (agents: Agent[]) => void
}
```

### 2. çŠ¶æ€æ›´æ–°è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„çŠ¶æ€æ›´æ–° - ä½¿ç”¨ Immer
setUser: (user) => set((state) => {
  Object.assign(state.user, user)
})

// âŒ é”™è¯¯çš„çŠ¶æ€æ›´æ–° - ç›´æ¥ä¿®æ”¹
setUser: (user) => set((state) => {
  state.user = user // é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€
})
```

### 3. çŠ¶æ€è®¢é˜…è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„çŠ¶æ€è®¢é˜… - ç²¾ç¡®è®¢é˜…
const user = useAppStore((state) => state.user)
const userActions = useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))

// âŒ é”™è¯¯çš„çŠ¶æ€è®¢é˜… - è®¢é˜…æ•´ä¸ªçŠ¶æ€
const state = useAppStore() // é”™è¯¯ï¼šè®¢é˜…æ•´ä¸ªçŠ¶æ€
```

### 4. çŠ¶æ€åŒæ­¥è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„çŠ¶æ€åŒæ­¥ - ä½¿ç”¨ useEffect
const useAgentSync = () => {
  const { data: agents } = useAgents()
  const setAgents = useAppStore((state) => state.setAgents)
  
  useEffect(() => {
    if (agents) {
      setAgents(agents)
    }
  }, [agents, setAgents])
}

// âŒ é”™è¯¯çš„çŠ¶æ€åŒæ­¥ - åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨
const MyComponent = () => {
  const { data: agents } = useAgents()
  const setAgents = useAppStore((state) => state.setAgents)
  
  // é”™è¯¯ï¼šåœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨
  if (agents) {
    setAgents(agents)
  }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. çŠ¶æ€é€‰æ‹©å™¨ä¼˜åŒ–
```typescript
// ä½¿ç”¨é€‰æ‹©å™¨é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const useUser = () => useAppStore((state) => state.user)
const useUserActions = () => useAppStore((state) => ({
  setUser: state.setUser,
  clearUser: state.clearUser
}))

// ä½¿ç”¨ç¨³å®šçš„é€‰æ‹©å™¨
const useStableSelectors = () => {
  const user = useUser()
  const userActions = useUserActions()
  
  return { user, userActions }
}
```

### 2. çŠ¶æ€åˆ†ç‰‡ä¼˜åŒ–
```typescript
// æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†çŠ¶æ€
const useAgentState = () => useAppStore((state) => state.agents)
const useUIState = () => useAppStore((state) => state.ui)
const useChatState = () => useAppStore((state) => state.chat)
```

### 3. çŠ¶æ€ç¼“å­˜ä¼˜åŒ–
```typescript
// ä½¿ç”¨ TanStack Query ç¼“å­˜æœåŠ¡ç«¯çŠ¶æ€
const { data: agents, isLoading } = useQuery({
  queryKey: ['agents'],
  queryFn: fetchAgents,
  staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿå†…æ•°æ®è¢«è®¤ä¸ºæ˜¯æ–°é²œçš„
  cacheTime: 10 * 60 * 1000 // 10åˆ†é’Ÿåæ¸…ç†ç¼“å­˜
})
```

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### 1. çŠ¶æ€æµ‹è¯•
```typescript
// __tests__/store/appStore.test.ts
describe('AppStore', () => {
  it('åº”è¯¥æ­£ç¡®è®¾ç½®ç”¨æˆ·ä¿¡æ¯', () => {
    const { result } = renderHook(() => useAppStore())
    
    act(() => {
      result.current.setUser({ id: '1', name: 'Test User' })
    })
    
    expect(result.current.user.id).toBe('1')
    expect(result.current.user.name).toBe('Test User')
  })
})
```

### 2. é€‰æ‹©å™¨æµ‹è¯•
```typescript
// __tests__/store/selectors.test.ts
describe('Selectors', () => {
  it('åº”è¯¥é€‰æ‹©ç”¨æˆ·çŠ¶æ€', () => {
    const { result } = renderHook(() => useUser())
    expect(result.current).toBeDefined()
  })
})
```

### 3. æ€§èƒ½æµ‹è¯•
```typescript
// __tests__/store/performance.test.ts
describe('Performance', () => {
  it('åº”è¯¥æ”¯æŒå¤§é‡çŠ¶æ€æ›´æ–°', () => {
    const { result } = renderHook(() => useAppStore())
    const startTime = performance.now()
    
    act(() => {
      for (let i = 0; i < 1000; i++) {
        result.current.setGlobalVariable(`key${i}`, `value${i}`)
      }
    })
    
    const endTime = performance.now()
    expect(endTime - startTime).toBeLessThan(100)
  })
})
```

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### çŠ¶æ€å®šä¹‰æ£€æŸ¥
- [ ] çŠ¶æ€æ¥å£å®Œæ•´å®šä¹‰
- [ ] çŠ¶æ€ç±»å‹å®‰å…¨
- [ ] çŠ¶æ€é»˜è®¤å€¼è®¾ç½®
- [ ] çŠ¶æ€éªŒè¯è§„åˆ™

### çŠ¶æ€æ›´æ–°æ£€æŸ¥
- [ ] ä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°
- [ ] çŠ¶æ€æ›´æ–°é€»è¾‘æ­£ç¡®
- [ ] çŠ¶æ€æ›´æ–°æ€§èƒ½ä¼˜åŒ–
- [ ] çŠ¶æ€æ›´æ–°é”™è¯¯å¤„ç†

### çŠ¶æ€è®¢é˜…æ£€æŸ¥
- [ ] ä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨
- [ ] é¿å…è®¢é˜…æ•´ä¸ªçŠ¶æ€
- [ ] çŠ¶æ€è®¢é˜…æ€§èƒ½ä¼˜åŒ–
- [ ] çŠ¶æ€è®¢é˜…æ¸…ç†

### çŠ¶æ€åŒæ­¥æ£€æŸ¥
- [ ] æœåŠ¡ç«¯çŠ¶æ€åŒæ­¥
- [ ] æœ¬åœ°çŠ¶æ€æŒä¹…åŒ–
- [ ] çŠ¶æ€åŒæ­¥é”™è¯¯å¤„ç†
- [ ] çŠ¶æ€åŒæ­¥æ€§èƒ½ä¼˜åŒ–

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **çŠ¶æ€æ›´æ–°**: å§‹ç»ˆä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°
2. **çŠ¶æ€è®¢é˜…**: ä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
3. **çŠ¶æ€åŒæ­¥**: ä½¿ç”¨ useEffect è¿›è¡ŒçŠ¶æ€åŒæ­¥
4. **çŠ¶æ€æµ‹è¯•**: ç¡®ä¿çŠ¶æ€ç®¡ç†é€»è¾‘æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–
5. **æ€§èƒ½ç›‘æ§**: æŒç»­ç›‘æ§çŠ¶æ€æ›´æ–°æ€§èƒ½

## ğŸ¯ æœ€ä½³å®è·µ

### 1. çŠ¶æ€è®¾è®¡
- æŒ‰åŠŸèƒ½æ¨¡å—è®¾è®¡çŠ¶æ€ç»“æ„
- ä½¿ç”¨æ‰å¹³åŒ–çŠ¶æ€ç»“æ„
- é¿å…æ·±å±‚åµŒå¥—çŠ¶æ€

### 2. çŠ¶æ€æ›´æ–°
- ä½¿ç”¨ Immer ç¡®ä¿ä¸å¯å˜æ›´æ–°
- æ‰¹é‡æ›´æ–°ç›¸å…³çŠ¶æ€
- é¿å…é¢‘ç¹çš„çŠ¶æ€æ›´æ–°

### 3. çŠ¶æ€è®¢é˜…
- ä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨
- é¿å…è®¢é˜…æ•´ä¸ªçŠ¶æ€
- ä½¿ç”¨ç¨³å®šçš„é€‰æ‹©å™¨å¼•ç”¨

### 4. çŠ¶æ€åŒæ­¥
- ä½¿ç”¨ TanStack Query ç®¡ç†æœåŠ¡ç«¯çŠ¶æ€
- ä½¿ç”¨ useEffect è¿›è¡ŒçŠ¶æ€åŒæ­¥
- å¤„ç†çŠ¶æ€åŒæ­¥é”™è¯¯

**è®°ä½: å¥½çš„çŠ¶æ€ç®¡ç†æ˜¯åº”ç”¨æ€§èƒ½çš„åŸºç¡€ï¼Œç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ç¡®ä¿åº”ç”¨çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚**