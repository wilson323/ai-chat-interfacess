---
description:
globs:
alwaysApply: false
---
# 业务需求规范

## 系统概述

### 1. 项目定位
NeuroGlass AI Chat Interface 是一个企业级多智能体对话平台，采用双端分离架构：
- **用户端**: 统一访问界面，无需登录，专注对话体验
- **管理员端**: 独立管理后台，需要登录，负责配置和监控

### 2. 核心业务价值
- **降低AI接入门槛**: 提供统一的智能体访问界面
- **数据透传架构**: 不存储用户数据，确保数据安全
- **灵活配置管理**: 支持多种AI模型和智能体类型
- **实时监控分析**: 提供全面的使用数据分析

---

## 用户端需求规范

### 1. 访问方式
- **地址**: 统一访问界面（主域名）
- **认证**: 无需登录，直接访问
- **设备识别**: 自动生成设备唯一ID，存储到localStorage

### 2. 核心功能需求

#### 2.1 智能体选择与切换
```mermaid
graph TB
    subgraph "智能体选择流程"
        A[访问用户端] --> B[显示智能体选择器]
        B --> C{选择智能体类型}
        C -->|FastGPT对话| D[显示聊天界面]
        C -->|CAD解读| E[显示文件上传界面]
        D --> F[开始对话]
        E --> G[上传CAD文件]
    end
```

**功能要求**:
- 左上角固定位置显示智能体选择器
- 支持下拉菜单或标签页形式
- 切换智能体时界面动态变化
- 保持选择状态，刷新页面后记住上次选择

#### 2.2 FastGPT对话智能体

**界面布局**:
```
┌─────────────────────────────────────┐
│ [智能体选择器] ▼                    │
├─────────────────────────────────────┤
│                                     │
│  对话消息区域                       │
│  ├─ 用户消息                        │
│  ├─ AI回复（流式显示）              │
│  ├─ 节点状态展示                    │
│  └─ 操作按钮（如有）                │
│                                     │
├─────────────────────────────────────┤
│ [消息输入框] [发送按钮]             │
└─────────────────────────────────────┘
```

**功能需求**:

##### 会话初始化
1. **设备ID生成**: 首次访问自动生成UUID作为设备标识
2. **会话ID创建**: 每次新建对话生成唯一会话ID
3. **FastGPT初始化**: 调用FastGPT初始化接口
4. **全局变量处理**: 
   - 检查是否有必填全局变量
   - 如有则弹出表单让用户填写
   - 支持下拉选择、文本输入等控件类型
5. **开场白显示**: 展示FastGPT配置的开场白

##### 消息交互
1. **流式输出**: 
   - 实时显示AI回复内容
   - 支持打字机效果
   - 显示"正在输入..."状态
2. **节点状态展示**:
   - 显示FastGPT工作流执行状态
   - 节点图标：等待中、执行中、完成、错误
   - 进度指示器显示当前执行节点
3. **操作按钮交互**:
   - 根据FastGPT返回动态生成按钮
   - 支持单选、多选、确认等交互
   - 点击后将结果发送回FastGPT
4. **消息格式支持**:
   - 纯文本消息
   - Markdown格式渲染
   - 代码块高亮显示
   - 图片、链接等富媒体内容

##### 数据处理约束
- **不做本地存储**: 所有对话记录仅存在FastGPT
- **仅透传消息**: 系统只负责消息传递，不做处理
- **会话管理**: 仅维护当前会话状态，不保存历史

#### 2.3 CAD解读智能体

**界面布局**:
```
┌─────────────────────────────────────┐
│ [智能体选择器] ▼                    │
├─────────────────────────────────────┤
│ 文件上传区域                        │
│ ┌─────────────────────────────────┐ │
│ │ 拖拽上传或点击选择文件          │ │
│ │ 支持: .dwg .dxf .pdf .jpg .png  │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ CAD图纸预览区域                     │
│ ├─ 缩略图显示                       │
│ ├─ 缩放控制                         │
│ └─ 图层控制                         │
├─────────────────────────────────────┤
│ 解读结果展示                        │
│ ├─ 进度指示器                       │
│ ├─ 结构化结果                       │
│ ├─ 可视化图表                       │
│ └─ 报告下载                         │
└─────────────────────────────────────┘
```

**功能需求**:

##### 文件上传
1. **支持格式**: .dwg, .dxf, .pdf, .jpg, .png
2. **文件大小**: 最大10MB
3. **上传方式**: 
   - 拖拽上传
   - 点击选择文件
   - 移动端支持拍照
4. **文件验证**:
   - 文件类型检查
   - 文件大小限制
   - 文件完整性验证

##### 图纸预览
1. **缩略图显示**: 支持CAD文件预览
2. **缩放功能**: 鼠标滚轮或手势缩放
3. **标注显示**: AI识别的关键区域高亮
4. **图层控制**: 支持图层显示/隐藏

##### 解读分析
1. **进度显示**: 实时显示分析进度
2. **AI模型调用**: 调用管理员配置的多模态模型
3. **结果结构化**: 按设备类型、区域分类展示
4. **可视化图表**: 设备分布图、统计图表

##### 结果展示
1. **详细报告**: 文字描述+图片标注
2. **导出功能**: 支持PDF、Word格式
3. **分享功能**: 生成分享链接（可选）

### 3. 用户体验要求

#### 3.1 性能要求
- **首屏加载**: < 2秒
- **智能体切换**: < 500ms
- **消息发送响应**: < 100ms
- **文件上传**: 支持大文件分片上传

#### 3.2 响应式设计
- **桌面端**: 完整功能展示
- **平板端**: 适配触摸操作
- **移动端**: 
  - 智能体选择器改为底部标签
  - 输入框固定底部，避免键盘遮挡
  - 优化触摸交互体验

#### 3.3 无障碍支持
- **键盘导航**: 支持Tab键导航
- **屏幕阅读器**: 语义化HTML标签
- **高对比度**: 支持高对比度模式

---

## 管理员端需求规范

### 1. 访问方式
- **地址**: 独立管理后台（子域名或路径）
- **认证**: 必须登录才能访问
- **权限**: 基于角色的访问控制

### 2. 登录认证系统

#### 2.1 登录页面
```
┌─────────────────────────────────────┐
│            系统Logo                 │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 用户名: [_______________]       │ │
│ │ 密码:   [_______________]       │ │
│ │                                 │ │
│ │ [ ] 记住登录状态                │ │
│ │                                 │ │
│ │        [登录按钮]               │ │
│ │                                 │ │
│ │ [忘记密码?]                     │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**功能需求**:
- JWT token认证机制
- 密码强度验证
- 登录失败次数限制
- 记住登录状态（可选）
- 密码重置功能

#### 2.2 权限管理
- **超级管理员**: 所有权限
- **普通管理员**: 智能体管理、模型配置
- **监控员**: 仅数据监控权限

### 3. 智能体管理模块

#### 3.1 FastGPT智能体配置

**配置流程**:
```mermaid
sequenceDiagram
    participant A as 管理员
    participant S as 系统
    participant F as FastGPT API
    
    A->>S: 输入AppID和密钥
    A->>S: 点击"获取配置"按钮
    S->>S: 生成会话ID
    S->>F: 调用初始化接口
    F->>S: 返回配置信息
    S->>S: 保存全局变量定义
    S->>S: 保存开场白
    S->>A: 显示配置成功
```

**配置表单**:
```
智能体配置
├─ 基础信息
│  ├─ 智能体名称: [必填]
│  ├─ 描述信息: [可选]
│  └─ 是否发布: [开关]
├─ FastGPT配置  
│  ├─ AppID: [必填]
│  ├─ API密钥: [必填，脱敏显示]
│  ├─ API地址: [可选，默认值]
│  └─ [获取配置] 按钮
├─ 自动获取配置
│  ├─ 全局变量: [自动填充]
│  ├─ 开场白: [自动填充]
│  └─ 其他配置: [自动填充]
└─ 操作按钮
   ├─ [保存配置]
   ├─ [测试连接]
   └─ [删除智能体]
```

**功能需求**:
1. **配置验证**: 
   - AppID格式验证
   - API密钥有效性检查
   - 网络连接测试
2. **自动配置获取**:
   - 调用FastGPT初始化接口
   - 解析返回的配置信息
   - 自动填充表单字段
3. **配置管理**:
   - 保存配置到数据库
   - 支持配置修改
   - 配置版本管理

#### 3.2 CAD解读智能体配置

**配置界面**:
```
CAD智能体配置
├─ 基础信息
│  ├─ 智能体名称: [必填]
│  ├─ 描述信息: [可选]
│  └─ 是否发布: [开关]
├─ AI模型选择
│  ├─ 模型类型: [下拉选择]
│  │  ├─ 多模态模型
│  │  ├─ 视觉理解模型
│  │  └─ 文本生成模型
│  ├─ 具体模型: [从模型库选择]
│  └─ 模型参数:
│     ├─ 温度: [滑块 0-1]
│     ├─ 最大Token: [数字输入]
│     └─ Top-P: [滑块 0-1]
├─ 解读配置
│  ├─ 分析模板: [文本编辑器]
│  ├─ 输出格式: [单选]
│  │  ├─ JSON
│  │  ├─ Markdown  
│  │  └─ HTML
│  └─ 结果后处理: [可选脚本]
└─ 操作按钮
   ├─ [保存配置]
   ├─ [测试分析]
   └─ [删除智能体]
```

**功能需求**:
1. **模型选择**: 从AI模型仓库选择可用模型
2. **参数配置**: 可视化配置模型参数
3. **模板编辑**: 支持分析提示词模板编辑
4. **测试功能**: 上传测试文件验证配置

#### 3.3 智能体列表管理

**列表界面**:
```
智能体管理
├─ 操作栏
│  ├─ [新增FastGPT智能体]
│  ├─ [新增CAD智能体]
│  ├─ [批量操作] ▼
│  └─ [搜索框]
├─ 列表表格
│  ├─ 列: 名称 | 类型 | 状态 | 创建时间 | 操作
│  ├─ 排序: 支持多列排序
│  ├─ 筛选: 按类型、状态筛选
│  └─ 分页: 每页20条记录
└─ 批量操作
   ├─ 批量发布/下线
   ├─ 批量删除
   └─ 导出配置
```

### 4. AI模型仓库模块

#### 4.1 模型管理架构

**模型分类**:
```
AI模型仓库
├─ NLP模型
│  ├─ 阿里千问系列
│  │  ├─ qwen-turbo
│  │  ├─ qwen-plus
│  │  └─ qwen-max
│  ├─ 硅基模型
│  │  ├─ silicon-chat
│  │  └─ silicon-code
│  └─ 其他大语言模型
├─ 多模态模型
│  ├─ 视觉理解模型
│  ├─ 图像生成模型
│  └─ 文档理解模型
└─ 语音模型
   ├─ TTS文字转语音
   └─ ASR语音识别
```

#### 4.2 模型配置界面

**NLP模型配置**:
```
NLP模型配置
├─ 基础信息
│  ├─ 模型名称: [必填]
│  ├─ 模型类型: [选择]
│  ├─ 提供商: [阿里/硅基/其他]
│  └─ 模型描述: [可选]
├─ API配置
│  ├─ API地址: [必填]
│  ├─ API密钥: [必填，加密存储]
│  ├─ API版本: [可选]
│  └─ 请求头配置: [JSON编辑器]
├─ 性能配置
│  ├─ QPS限制: [数字输入]
│  ├─ 最大并发: [数字输入]
│  ├─ 超时时间: [秒]
│  └─ 重试次数: [数字输入]
├─ 默认参数
│  ├─ 温度: [0-2]
│  ├─ 最大Token: [1-32000]
│  ├─ Top-P: [0-1]
│  ├─ Top-K: [1-100]
│  └─ 操作按钮
│     ├─ [保存配置]
│     ├─ [测试连接]
│     ├─ [健康检查]
│     └─ [删除模型]
```

**语音模型配置**:
```
语音模型配置
├─ TTS配置
│  ├─ 服务提供商: [选择]
│  ├─ 音色选择: [下拉菜单]
│  ├─ 语速设置: [滑块]
│  ├─ 音调设置: [滑块]
│  └─ 输出格式: [MP3/WAV/OGG]
└─ ASR配置
   ├─ 识别语言: [多选]
   ├─ 音频格式: [支持格式列表]
   ├─ 采样率: [8k/16k/44.1k]
   └─ 识别精度: [快速/标准/高精度]
```

#### 4.3 模型监控

**监控面板**:
```
模型性能监控
├─ 实时指标
│  ├─ 请求量: [实时数字]
│  ├─ 成功率: [百分比]
│  ├─ 平均响应时间: [毫秒]
│  └─ 错误率: [百分比]
├─ 趋势图表
│  ├─ 请求量趋势: [时间序列图]
│  ├─ 响应时间分布: [直方图]
│  ├─ 错误类型统计: [饼图]
│  └─ QPS使用情况: [仪表盘]
└─ 告警设置
   ├─ 响应时间告警: [阈值设置]
   ├─ 错误率告警: [阈值设置]
   ├─ QPS超限告警: [阈值设置]
   └─ 通知方式: [邮件/短信/钉钉]
```

### 5. 数据监控模块

#### 5.1 全国IP请求热点地图

**地图功能**:
```mermaid
graph TB
    subgraph "地图展示"
        A[中国地图底图]
        B[热点标记]
        C[数据图层]
        D[交互控件]
    end
    
    subgraph "数据维度"
        E[按智能体类型分层]
        F[按时间段筛选]
        G[按地区钻取]
        H[实时/历史切换]
    end
    
    A --> B
    B --> C
    C --> D
    E --> A
    F --> A
    G --> A
    H --> A
```

**界面布局**:
```
数据监控 - IP热点地图
├─ 控制面板
│  ├─ 时间选择: [今日/本周/本月/自定义]
│  ├─ 智能体筛选: [全部/FastGPT/CAD解读]
│  ├─ 数据刷新: [自动/手动]
│  └─ 图层控制: [热点/标记/边界]
├─ 地图区域
│  ├─ 中国地图: [可缩放拖拽]
│  ├─ 热点显示: [颜色深浅表示密度]
│  ├─ 标记点: [具体位置标记]
│  └─ 信息窗口: [点击显示详情]
├─ 统计面板
│  ├─ 总请求量: [数字显示]
│  ├─ 活跃地区: [排行榜]
│  ├─ 智能体使用: [饼图]
│  └─ 时段分布: [柱状图]
└─ 导出功能
   ├─ 截图导出
   ├─ 数据导出
   └─ 报告生成
```

#### 5.2 区域请求TOP10

**统计维度**:
- 按省份统计请求量
- 按城市统计请求量  
- 按智能体类型分组
- 按时间段对比

**展示形式**:
```
区域请求TOP10
├─ 排行榜表格
│  ├─ 排名 | 地区 | 请求量 | 占比 | 趋势
│  ├─ 支持排序和筛选
│  └─ 点击查看详情
├─ 可视化图表
│  ├─ 柱状图: 请求量对比
│  ├─ 饼图: 占比分布
│  └─ 趋势图: 时间变化
└─ 详情钻取
   ├─ 地区详情页
   ├─ 用户行为分析
   └─ 智能体使用偏好
```

#### 5.3 实时监控面板

**监控指标**:
```
实时监控面板
├─ 核心指标
│  ├─ 在线用户数: [实时数字]
│  ├─ 总请求量: [累计数字]
│  ├─ 平均响应时间: [毫秒]
│  └─ 系统健康度: [百分比]
├─ 智能体状态
│  ├─ FastGPT智能体: [在线/离线]
│  ├─ CAD解读智能体: [在线/离线]
│  └─ 各智能体请求量: [实时更新]
├─ 系统资源
│  ├─ CPU使用率: [仪表盘]
│  ├─ 内存使用率: [仪表盘]
│  ├─ 网络带宽: [实时图表]
│  └─ 存储空间: [进度条]
└─ 告警信息
   ├─ 实时告警: [列表显示]
   ├─ 告警级别: [颜色区分]
   ├─ 处理状态: [已处理/未处理]
   └─ 告警历史: [查看详情]
```

### 6. 系统设置模块

#### 6.1 基础配置
- 系统名称和Logo
- 默认语言设置
- 时区配置
- 邮件服务配置

#### 6.2 安全设置
- 密码策略配置
- 登录安全设置
- API访问控制
- 数据备份策略

#### 6.3 通知配置
- 邮件通知设置
- 短信通知配置
- 钉钉/企微集成
- 告警规则配置

---

## 数据流向规范

### 1. 用户端数据流

```mermaid
sequenceDiagram
    participant U as 用户
    participant C as 用户端
    participant A as API网关
    participant F as FastGPT
    participant M as AI模型
    
    U->>C: 发送消息
    C->>A: 透传请求
    A->>F: 调用FastGPT API
    F-->>A: 流式响应
    A-->>C: 透传响应
    C-->>U: 实时显示
    
    Note over C: 不做本地存储
    Note over F: 所有数据存储在FastGPT
```

### 2. 管理端数据流

```mermaid
sequenceDiagram
    participant A as 管理员
    participant M as 管理端
    participant D as 数据库
    participant E as 外部API
    participant L as 日志系统
    
    A->>M: 配置智能体
    M->>E: 验证API连接
    E-->>M: 返回验证结果
    M->>D: 保存配置
    M->>L: 记录操作日志
    L-->>M: 确认记录
    M-->>A: 显示配置结果
```

---

## 非功能性需求

### 1. 性能需求
- **并发用户**: 支持1000+并发用户
- **响应时间**: API响应时间<500ms
- **吞吐量**: 支持10000+请求/分钟
- **可用性**: 99.9%系统可用性

### 2. 安全需求
- **数据加密**: 传输和存储数据加密
- **访问控制**: 基于角色的权限管理
- **审计日志**: 完整的操作审计记录
- **防护机制**: 防SQL注入、XSS等攻击

### 3. 兼容性需求
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+
- **移动端**: iOS 13+, Android 8+
- **屏幕分辨率**: 支持1920x1080到375x667
- **网络环境**: 支持3G/4G/5G/WiFi

### 4. 可维护性需求
- **代码规范**: 严格遵循编码规范
- **文档完整**: 完整的技术文档
- **监控告警**: 完善的监控和告警机制
- **备份恢复**: 可靠的数据备份和恢复

---

**注意**: 本需求规范是项目开发的基础文档，所有功能开发都必须严格按照此规范执行。如有变更需求，必须经过需求评审和架构师确认。
