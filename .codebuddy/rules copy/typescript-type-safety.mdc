---
alwaysApply: true
globs: *.ts,*.tsx
description: TypeScriptç±»å‹å®‰å…¨è§„èŒƒ - ç¡®ä¿å…¨å±€ç±»å‹å®šä¹‰ç»Ÿä¸€å’Œç±»å‹å®‰å…¨
---

# ğŸ”’ TypeScriptç±»å‹å®‰å…¨è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 1. ä¸¥æ ¼ç±»å‹æ£€æŸ¥ â­â­â­
- **ç¦æ­¢anyç±»å‹**: ä¸¥æ ¼ç¦æ­¢ä½¿ç”¨anyç±»å‹ï¼Œå¿…é¡»ä½¿ç”¨å…·ä½“ç±»å‹
- **ç±»å‹å®šä¹‰ç»Ÿä¸€**: æ‰€æœ‰ç±»å‹å®šä¹‰å¿…é¡»åœ¨`types/`ç›®å½•ä¸‹ç»Ÿä¸€ç®¡ç†
- **ç±»å‹å¯¼å…¥è§„èŒƒ**: ç»Ÿä¸€ä»`types/index.ts`å¯¼å…¥ç±»å‹
- **ç±»å‹å®‰å…¨ä¼˜å…ˆ**: ç±»å‹å®‰å…¨ä¼˜äºå¼€å‘ä¾¿åˆ©æ€§

### 2. ç±»å‹å®šä¹‰è§„èŒƒ â­â­â­
- **ç»Ÿä¸€ç±»å‹ä¸­å¿ƒ**: æ‰€æœ‰ç±»å‹å®šä¹‰åœ¨`types/index.ts`ä¸­ç»Ÿä¸€å¯¼å‡º
- **é¿å…é‡å¤å®šä¹‰**: ç¦æ­¢åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å®šä¹‰ç›¸åŒç±»å‹
- **ç±»å‹å‘½åè§„èŒƒ**: ä½¿ç”¨PascalCaseå‘½åæ¥å£å’Œç±»å‹
- **ç±»å‹æ–‡æ¡£åŒ–**: å¤æ‚ç±»å‹å¿…é¡»æ·»åŠ JSDocæ³¨é‡Š

## ğŸ“‹ ç±»å‹å®šä¹‰è¦æ±‚

### 1. åŸºç¡€ç±»å‹è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„ç±»å‹å®šä¹‰
export interface UserProps {
  id: string
  name: string
  email: string
  age?: number
  isActive: boolean
}

// âœ… ä½¿ç”¨è”åˆç±»å‹
export type Status = 'pending' | 'approved' | 'rejected'

// âœ… ä½¿ç”¨æ³›å‹
export interface ApiResponse<T> {
  success: boolean
  data: T
  error?: string
}

// âŒ ç¦æ­¢ä½¿ç”¨anyç±»å‹
export function badFunction(data: any): any {
  // ä¸¥æ ¼ç¦æ­¢
}
```

### 2. ç»„ä»¶Propsç±»å‹è§„èŒƒ
```typescript
// âœ… ç»„ä»¶Propsç±»å‹å®šä¹‰
export interface ButtonProps {
  children: React.ReactNode
  variant?: 'primary' | 'secondary' | 'outline'
  size?: 'sm' | 'md' | 'lg'
  disabled?: boolean
  onClick?: () => void
  className?: string
}

// âœ… ä½¿ç”¨æ³›å‹Props
export interface ListProps<T> {
  items: T[]
  renderItem: (item: T) => React.ReactNode
  keyExtractor: (item: T) => string
}
```

### 3. APIç±»å‹è§„èŒƒ
```typescript
// âœ… APIè¯·æ±‚ç±»å‹
export interface CreateUserRequest {
  name: string
  email: string
  password: string
}

// âœ… APIå“åº”ç±»å‹
export interface UserResponse {
  id: string
  name: string
  email: string
  createdAt: string
  updatedAt: string
}

// âœ… ç»Ÿä¸€APIå“åº”æ ¼å¼
export interface ApiResponse<T = unknown> {
  success: boolean
  data?: T
  error?: {
    code: string
    message: string
    details?: unknown
  }
  meta?: {
    timestamp: string
    requestId: string
  }
}
```

## ğŸš« ä¸¥æ ¼ç¦æ­¢çš„ç±»å‹ä½¿ç”¨

### 1. ç¦æ­¢anyç±»å‹
```typescript
// âŒ ä¸¥æ ¼ç¦æ­¢
function processData(data: any): any {
  return data.someProperty
}

// âœ… æ­£ç¡®åšæ³•
interface DataType {
  someProperty: string
}
function processData(data: DataType): string {
  return data.someProperty
}
```

### 2. ç¦æ­¢objectç±»å‹
```typescript
// âŒ ç¦æ­¢ä½¿ç”¨object
function handleObject(obj: object) {
  // å¤ªå®½æ³›ï¼Œä¸æ˜ç¡®
}

// âœ… ä½¿ç”¨å…·ä½“æ¥å£
interface SpecificObject {
  id: string
  name: string
}
function handleObject(obj: SpecificObject) {
  // æ˜ç¡®å…·ä½“å±æ€§
}
```

### 3. ç¦æ­¢Functionç±»å‹
```typescript
// âŒ ç¦æ­¢ä½¿ç”¨Function
function handleCallback(callback: Function) {
  // ä¸æ˜ç¡®å‚æ•°å’Œè¿”å›å€¼
}

// âœ… ä½¿ç”¨å…·ä½“å‡½æ•°ç±»å‹
function handleCallback(callback: (value: string) => void) {
  // æ˜ç¡®å‚æ•°å’Œè¿”å›å€¼ç±»å‹
}
```

## ğŸ“ ç±»å‹æ–‡ä»¶ç»„ç»‡è§„èŒƒ

### 1. ç»Ÿä¸€ç±»å‹å¯¼å‡º
```typescript
// types/index.ts - ç»Ÿä¸€ç±»å‹å¯¼å‡ºä¸­å¿ƒ
export * from './agent'
export * from './message'
export * from './api'
export * from './global'

// é‡æ–°å¯¼å‡ºå¸¸ç”¨ç±»å‹
export type {
  Agent,
  Message,
  ApiResponse,
  UserProps
} from './agent'
```

### 2. ç±»å‹æ–‡ä»¶å‘½åè§„èŒƒ
```
types/
â”œâ”€â”€ index.ts          # ç»Ÿä¸€å¯¼å‡ºä¸­å¿ƒ
â”œâ”€â”€ agent.ts          # æ™ºèƒ½ä½“ç›¸å…³ç±»å‹
â”œâ”€â”€ message.ts        # æ¶ˆæ¯ç›¸å…³ç±»å‹
â”œâ”€â”€ api.ts           # APIç›¸å…³ç±»å‹
â”œâ”€â”€ global.ts        # å…¨å±€ç±»å‹å®šä¹‰
â””â”€â”€ errors.ts        # é”™è¯¯ç±»å‹å®šä¹‰
```

### 3. ç±»å‹å¯¼å…¥è§„èŒƒ
```typescript
// âœ… ç»Ÿä¸€ä»types/index.tså¯¼å…¥
import type { Agent, Message, ApiResponse } from '@/types'

// âŒ ç¦æ­¢ä»å…·ä½“æ–‡ä»¶å¯¼å…¥
import type { Agent } from '@/types/agent'
import type { Message } from '@/types/message'
```

## ğŸ”§ ç±»å‹å·¥å…·å’ŒåŠ©æ‰‹

### 1. ç±»å‹å®ˆå«
```typescript
// âœ… ç±»å‹å®ˆå«å‡½æ•°
export function isAgent(obj: unknown): obj is Agent {
  return (
    typeof obj === 'object' &&
    obj !== null &&
    'id' in obj &&
    'name' in obj &&
    'description' in obj
  )
}

// âœ… ä½¿ç”¨ç±»å‹å®ˆå«
function processAgent(data: unknown) {
  if (isAgent(data)) {
    // dataç°åœ¨æ˜¯Agentç±»å‹
    console.log(data.name)
  }
}
```

### 2. ç±»å‹æ–­è¨€è§„èŒƒ
```typescript
// âœ… å®‰å…¨çš„ç±»å‹æ–­è¨€
function processData(data: unknown) {
  if (typeof data === 'object' && data !== null) {
    const obj = data as Record<string, unknown>
    // ä½¿ç”¨Recordç±»å‹è€Œä¸æ˜¯any
  }
}

// âŒ ä¸å®‰å…¨çš„ç±»å‹æ–­è¨€
function badProcessData(data: unknown) {
  const obj = data as any // ç¦æ­¢
}
```

### 3. æ³›å‹çº¦æŸ
```typescript
// âœ… ä½¿ç”¨æ³›å‹çº¦æŸ
interface Repository<T extends { id: string }> {
  findById(id: string): Promise<T | null>
  save(entity: T): Promise<T>
  delete(id: string): Promise<void>
}

// âœ… æ¡ä»¶ç±»å‹
type NonNullable<T> = T extends null | undefined ? never : T
```

## ğŸ§ª ç±»å‹æµ‹è¯•è§„èŒƒ

### 1. ç±»å‹æµ‹è¯•è¦æ±‚
```typescript
// âœ… ç±»å‹æµ‹è¯•ç¤ºä¾‹
import type { Agent } from '@/types'

// ç¡®ä¿ç±»å‹æ­£ç¡®æ€§
const testAgent: Agent = {
  id: 'test-id',
  name: 'Test Agent',
  description: 'Test Description',
  type: 'conversation',
  isActive: true,
  config: {
    model: 'gpt-4',
    temperature: 0.7,
    maxTokens: 1000
  }
}

// ç¡®ä¿ç±»å‹é”™è¯¯ä¼šè¢«æ•è·
// const invalidAgent: Agent = {
//   id: 'test-id',
//   name: 'Test Agent'
//   // ç¼ºå°‘å¿…éœ€å±æ€§ï¼ŒTypeScriptä¼šæŠ¥é”™
// }
```

### 2. ç±»å‹å…¼å®¹æ€§æµ‹è¯•
```typescript
// âœ… æµ‹è¯•ç±»å‹å…¼å®¹æ€§
function testTypeCompatibility() {
  const agent: Agent = testAgent
  const message: Message = {
    id: 'msg-1',
    role: 'user',
    content: 'Hello',
    timestamp: new Date().toISOString()
  }
  
  // ç¡®ä¿ç±»å‹å…¼å®¹
  const response: ApiResponse<Message> = {
    success: true,
    data: message
  }
}
```

## ğŸ” ç±»å‹æ£€æŸ¥å·¥å…·

### 1. TypeScripté…ç½®
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true
  }
}
```

### 2. ESLintç±»å‹è§„åˆ™
```json
// .eslintrc.json
{
  "rules": {
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "@typescript-eslint/no-inferrable-types": "error"
  }
}
```

## ğŸ“Š ç±»å‹è´¨é‡æŒ‡æ ‡

### 1. ç±»å‹è¦†ç›–ç‡è¦æ±‚
- **anyç±»å‹ä½¿ç”¨**: 0ä¸ª
- **ç±»å‹å®šä¹‰å®Œæ•´æ€§**: 100%
- **ç±»å‹å¯¼å…¥ç»Ÿä¸€æ€§**: 100%
- **ç±»å‹æ–‡æ¡£è¦†ç›–ç‡**: â‰¥ 80%

### 2. ç±»å‹æ£€æŸ¥å‘½ä»¤
```bash
# ç±»å‹æ£€æŸ¥
npm run type-check

# ç±»å‹è¦†ç›–ç‡æ£€æŸ¥
npm run type-coverage

# ç±»å‹å®‰å…¨æ‰«æ
npm run type-scan
```

## âš ï¸ å¸¸è§ç±»å‹é”™è¯¯

### 1. ç±»å‹å®šä¹‰é”™è¯¯
```typescript
// âŒ é”™è¯¯ï¼šä½¿ç”¨anyç±»å‹
interface BadInterface {
  data: any
  callback: any
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å…·ä½“ç±»å‹
interface GoodInterface {
  data: Record<string, unknown>
  callback: (value: string) => void
}
```

### 2. ç±»å‹å¯¼å…¥é”™è¯¯
```typescript
// âŒ é”™è¯¯ï¼šåˆ†æ•£å¯¼å…¥
import type { Agent } from '@/types/agent'
import type { Message } from '@/types/message'

// âœ… æ­£ç¡®ï¼šç»Ÿä¸€å¯¼å…¥
import type { Agent, Message } from '@/types'
```

### 3. ç±»å‹ä½¿ç”¨é”™è¯¯
```typescript
// âŒ é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…
function processUser(user: any) {
  return user.name.toUpperCase()
}

// âœ… æ­£ç¡®ï¼šç±»å‹å®‰å…¨
function processUser(user: { name: string }) {
  return user.name.toUpperCase()
}
```

## ğŸ¯ ç±»å‹å®‰å…¨æœ€ä½³å®è·µ

### 1. å¼€å‘å‰æ£€æŸ¥
- [ ] ç¡®è®¤ç±»å‹å®šä¹‰åœ¨`types/`ç›®å½•ä¸‹
- [ ] æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†anyç±»å‹
- [ ] éªŒè¯ç±»å‹å¯¼å…¥æ˜¯å¦ç»Ÿä¸€
- [ ] ç¡®ä¿ç±»å‹æ–‡æ¡£å®Œæ•´

### 2. ä»£ç å®¡æŸ¥è¦ç‚¹
- [ ] ç±»å‹å®šä¹‰æ˜¯å¦æ¸…æ™°æ˜ç¡®
- [ ] æ˜¯å¦é¿å…äº†anyç±»å‹ä½¿ç”¨
- [ ] ç±»å‹å¯¼å…¥æ˜¯å¦ç»Ÿä¸€è§„èŒƒ
- [ ] ç±»å‹æµ‹è¯•æ˜¯å¦å……åˆ†

### 3. æŒç»­æ”¹è¿›
- [ ] å®šæœŸæ£€æŸ¥anyç±»å‹ä½¿ç”¨
- [ ] ä¼˜åŒ–ç±»å‹å®šä¹‰ç»“æ„
- [ ] å®Œå–„ç±»å‹æ–‡æ¡£
- [ ] æå‡ç±»å‹è¦†ç›–ç‡

---

## ğŸš¨ é‡è¦æé†’

1. **é›¶å®¹å¿anyç±»å‹**: ä¸¥æ ¼ç¦æ­¢ä½¿ç”¨anyç±»å‹
2. **ç»Ÿä¸€ç±»å‹ç®¡ç†**: æ‰€æœ‰ç±»å‹å®šä¹‰åœ¨`types/`ç›®å½•ä¸‹ç»Ÿä¸€ç®¡ç†
3. **ç±»å‹å®‰å…¨ä¼˜å…ˆ**: ç±»å‹å®‰å…¨ä¼˜äºå¼€å‘ä¾¿åˆ©æ€§
4. **æŒç»­ç±»å‹æ£€æŸ¥**: å®šæœŸè¿›è¡Œç±»å‹å®‰å…¨æ£€æŸ¥å’Œä¼˜åŒ–

**è®°ä½**: å¥½çš„ç±»å‹å®šä¹‰æ˜¯ä»£ç è´¨é‡çš„åŸºç¡€ï¼Œä¸¥æ ¼éµå¾ªç±»å‹å®‰å…¨è§„èŒƒï¼