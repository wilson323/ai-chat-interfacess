---
alwaysApply: true
trigger: always_on
---

# ğŸ“Š ä»£ç è´¨é‡è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 1. ä»£ç è´¨é‡è‡³ä¸Š
- **TypeScriptä¸¥æ ¼æ¨¡å¼**: ç¦æ­¢ä½¿ç”¨anyç±»å‹
- **é›¶å®¹å¿é”™è¯¯**: æ‰€æœ‰ä»£ç å¿…é¡»é€šè¿‡æ£€æŸ¥
- **DRYåŸåˆ™**: ä¸¥æ ¼ç¦æ­¢ä»£ç é‡å¤
- **å•ä¸€èŒè´£**: æ¯ä¸ªå‡½æ•°/ç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½

## ğŸ“Š è´¨é‡æŒ‡æ ‡è¦æ±‚

### 1. ä»£ç è´¨é‡æŒ‡æ ‡
- **è‡ªå®šä¹‰ä»£ç å æ¯”**: < 20%
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: â‰¥ 80%
- **é›†æˆæµ‹è¯•è¦†ç›–ç‡**: â‰¥ 60%
- **å…³é”®ä¸šåŠ¡é€»è¾‘è¦†ç›–ç‡**: â‰¥ 90%
- **ä»£ç é‡å¤ç‡**: < 3%
- **åœˆå¤æ‚åº¦**: < 10

### 2. æ€§èƒ½æŒ‡æ ‡
- **é¦–å±åŠ è½½æ—¶é—´**: < 3ç§’
- **APIå“åº”æ—¶é—´**: < 500ms
- **å†…å­˜ä½¿ç”¨ç‡**: < 80%
- **åŒ…ä½“ç§¯å¢é•¿**: < 10%

## ğŸ”§ ä»£ç è§„èŒƒè¦æ±‚

### 1. TypeScriptè§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„ç±»å‹å®šä¹‰
export interface UserProps {
  id: string
  name: string
  email: string
  age?: number
  isActive: boolean
}

// âœ… å‡½æ•°ç±»å‹å®šä¹‰
export function createUser(userData: UserProps): Promise<User> {
  // å®ç°é€»è¾‘
}

// âŒ ç¦æ­¢ä½¿ç”¨anyç±»å‹
export function badFunction(data: any): any {
  // ç¦æ­¢ä½¿ç”¨any
}

// âœ… ä½¿ç”¨æ³›å‹
export function processData<T>(data: T[]): T[] {
  return data.filter(item => item !== null)
}
```

### 2. å‘½åè§„èŒƒ
```typescript
// âœ… å¥½çš„å‘½å - æ¸…æ™°è¡¨è¾¾æ„å›¾
function createNewConversation(): void
function handleUserInput(input: string): void
function validateMessageContent(content: string): boolean
function calculateTotalPrice(items: CartItem[]): number

// âŒ ä¸å¥½çš„å‘½å - æ¨¡ç³Šä¸æ¸…
function fn(): void
function handle(e: Event): void
function process(data: any): any
function calc(items: any[]): number
```

### 3. å‡½æ•°è®¾è®¡è§„èŒƒ
```typescript
// âœ… å•ä¸€èŒè´£ - æ¯ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹
export function validateEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  return emailRegex.test(email)
}

export function formatUserName(firstName: string, lastName: string): string {
  return `${firstName} ${lastName}`.trim()
}

// âŒ å¤šèŒè´£ - è¿åå•ä¸€èŒè´£åŸåˆ™
export function processUserData(userData: any): any {
  // éªŒè¯æ•°æ®
  // æ ¼å¼åŒ–æ•°æ®
  // ä¿å­˜æ•°æ®
  // å‘é€é€šçŸ¥
  // å¤ªå¤šèŒè´£ï¼
}
```

### 4. ç»„ä»¶è®¾è®¡è§„èŒƒ
```typescript
// âœ… å¥½çš„ç»„ä»¶è®¾è®¡
interface ButtonProps {
  variant?: 'default' | 'destructive' | 'outline' | 'secondary' | 'ghost' | 'link'
  size?: 'default' | 'sm' | 'lg' | 'icon'
  children: React.ReactNode
  onClick?: () => void
  disabled?: boolean
  className?: string
}

export function Button({ 
  variant = 'default', 
  size = 'default', 
  children, 
  onClick, 
  disabled = false,
  className 
}: ButtonProps) {
  return (
    <button
      className={cn(buttonVariants({ variant, size }), className)}
      onClick={onClick}
      disabled={disabled}
    >
      {children}
    </button>
  )
}

// âŒ ä¸å¥½çš„ç»„ä»¶è®¾è®¡
export function BadButton(props: any) {
  // ä½¿ç”¨anyç±»å‹
  // æ²¡æœ‰æ˜ç¡®çš„æ¥å£å®šä¹‰
  // èŒè´£ä¸æ¸…æ™°
}
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†è§„èŒƒ

### 1. ç»Ÿä¸€é”™è¯¯å¤„ç†
```typescript
// âœ… è‡ªå®šä¹‰é”™è¯¯ç±»
export class ApiError extends Error {
  constructor(
    public code: string,
    message: string,
    public statusCode: number = 500,
    public details?: unknown
  ) {
    super(message)
    this.name = 'ApiError'
  }
}

// âœ… é”™è¯¯å¤„ç†ä¸­é—´ä»¶
export function errorHandler(error: Error) {
  if (error instanceof ApiError) {
    return {
      code: error.code,
      message: error.message,
      statusCode: error.statusCode,
      details: error.details
    }
  }
  
  return {
    code: 'UNKNOWN_ERROR',
    message: 'æœªçŸ¥é”™è¯¯',
    statusCode: 500
  }
}

// âœ… å¼‚æ­¥å‡½æ•°é”™è¯¯å¤„ç†
export async function fetchUserData(userId: string): Promise<User> {
  try {
    const response = await fetch(`/api/users/${userId}`)
    
    if (!response.ok) {
      throw new ApiError(
        'USER_NOT_FOUND',
        'ç”¨æˆ·ä¸å­˜åœ¨',
        response.status
      )
    }
    
    return await response.json()
  } catch (error) {
    if (error instanceof ApiError) {
      throw error
    }
    
    throw new ApiError(
      'FETCH_ERROR',
      'è·å–ç”¨æˆ·æ•°æ®å¤±è´¥',
      500,
      error
    )
  }
}
```

### 2. è¾“å…¥éªŒè¯
```typescript
// âœ… ä½¿ç”¨Zodè¿›è¡Œä¸¥æ ¼éªŒè¯
import { z } from 'zod'

const UserSchema = z.object({
  name: z.string().min(1, 'å§“åä¸èƒ½ä¸ºç©º').max(100, 'å§“åä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦'),
  email: z.string().email('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'),
  age: z.number().min(0, 'å¹´é¾„ä¸èƒ½å°äº0').max(150, 'å¹´é¾„ä¸èƒ½è¶…è¿‡150'),
  isActive: z.boolean().default(true)
})

export function validateUser(input: unknown) {
  try {
    return UserSchema.parse(input)
  } catch (error) {
    if (error instanceof z.ZodError) {
      throw new ApiError(
        'VALIDATION_ERROR',
        'æ•°æ®éªŒè¯å¤±è´¥',
        400,
        error.errors
      )
    }
    throw error
  }
}
```

## ğŸ“ æ³¨é‡Šè§„èŒƒ

### 1. JSDocæ³¨é‡Š
```typescript
/**
 * åˆ›å»ºæ–°çš„å¯¹è¯ä¼šè¯
 * @description åˆå§‹åŒ–æ–°çš„èŠå¤©ä¼šè¯ï¼Œé‡ç½®ç›¸å…³çŠ¶æ€ï¼Œå¹¶è¿”å›ä¼šè¯ID
 * @param {string} agentId - æ™ºèƒ½ä½“ID
 * @param {string} userId - ç”¨æˆ·ID
 * @param {ConversationOptions} options - ä¼šè¯é€‰é¡¹
 * @returns {Promise<Conversation>} è¿”å›æ–°åˆ›å»ºçš„ä¼šè¯å¯¹è±¡
 * @throws {ApiError} å½“æ™ºèƒ½ä½“ä¸å­˜åœ¨æˆ–ç”¨æˆ·æ— æƒé™æ—¶æŠ›å‡º
 * @example
 * ```typescript
 * const conversation = await createNewConversation(
 *   'agent-123',
 *   'user-456',
 *   { maxMessages: 100 }
 * )
 * ```
 */
export async function createNewConversation(
  agentId: string,
  userId: string,
  options: ConversationOptions = {}
): Promise<Conversation> {
  // å®ç°é€»è¾‘
}
```

### 2. å¤æ‚é€»è¾‘æ³¨é‡Š
```typescript
export function calculateComplexScore(data: UserData[]): number {
  // 1. è¿‡æ»¤æœ‰æ•ˆç”¨æˆ·æ•°æ®
  const validUsers = data.filter(user => 
    user.isActive && user.score !== null
  )
  
  // 2. è®¡ç®—åŠ æƒå¹³å‡åˆ†
  // æƒé‡ï¼šæ´»è·ƒåº¦(0.3) + è¯„åˆ†(0.7)
  const weightedSum = validUsers.reduce((sum, user) => {
    const weight = user.isActive ? 0.3 : 0.1
    return sum + (user.score * weight)
  }, 0)
  
  // 3. è¿”å›æ ‡å‡†åŒ–åˆ†æ•° (0-100)
  return Math.min(100, Math.max(0, weightedSum))
}
```

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### 1. æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: â‰¥ 80%
- **é›†æˆæµ‹è¯•è¦†ç›–ç‡**: â‰¥ 60%
- **å…³é”®ä¸šåŠ¡é€»è¾‘è¦†ç›–ç‡**: â‰¥ 90%

### 2. æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

### 3. æµ‹è¯•ç¤ºä¾‹
```typescript
// âœ… ç»„ä»¶æµ‹è¯•ç¤ºä¾‹
import { render, screen, fireEvent } from '@testing-library/react'
import { Button } from '@/components/ui/button'

describe('Button', () => {
  it('should render button with correct text', () => {
    render(<Button>Click me</Button>)
    expect(screen.getByText('Click me')).toBeInTheDocument()
  })

  it('should call onClick when clicked', () => {
    const handleClick = jest.fn()
    render(<Button onClick={handleClick}>Click me</Button>)
    
    fireEvent.click(screen.getByText('Click me'))
    expect(handleClick).toHaveBeenCalledTimes(1)
  })

  it('should be disabled when disabled prop is true', () => {
    render(<Button disabled>Click me</Button>)
    expect(screen.getByRole('button')).toBeDisabled()
  })
})

// âœ… å‡½æ•°æµ‹è¯•ç¤ºä¾‹
import { validateEmail, formatUserName } from '@/lib/utils'

describe('validateEmail', () => {
  it('should return true for valid email', () => {
    expect(validateEmail('test@example.com')).toBe(true)
  })

  it('should return false for invalid email', () => {
    expect(validateEmail('invalid-email')).toBe(false)
    expect(validateEmail('')).toBe(false)
  })
})

describe('formatUserName', () => {
  it('should format first and last name correctly', () => {
    expect(formatUserName('John', 'Doe')).toBe('John Doe')
  })

  it('should handle empty names', () => {
    expect(formatUserName('', '')).toBe('')
    expect(formatUserName('John', '')).toBe('John')
  })
})
```

## âš¡ æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 1. ä»£ç åˆ†å‰²
```typescript
// âœ… ä½¿ç”¨åŠ¨æ€å¯¼å…¥
import { lazy, Suspense } from 'react'

const CADAnalyzer = lazy(() => import('@/components/cad-analyzer'))
const ImageEditor = lazy(() => import('@/components/image-editor'))

export function FeaturePage() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <CADAnalyzer />
    </Suspense>
  )
}
```

### 2. çŠ¶æ€ç®¡ç†ä¼˜åŒ–
```typescript
// âœ… ä½¿ç”¨useCallbackä¼˜åŒ–
import { useCallback, useMemo } from 'react'

export function UserProfile({ user, onUpdate }: UserProfileProps) {
  const handleSubmit = useCallback((data: FormData) => {
    onUpdate(user.id, data)
  }, [user.id, onUpdate])

  const expensiveValue = useMemo(() => {
    return computeExpensiveValue(user.data)
  }, [user.data])

  return (
    <form onSubmit={handleSubmit}>
      {/* è¡¨å•å†…å®¹ */}
    </form>
  )
}
```

### 3. è™šæ‹Ÿæ»šåŠ¨
```typescript
// âœ… å¤§é‡æ•°æ®ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList as List } from 'react-window'

export function MessageList({ messages }: MessageListProps) {
  const Row = ({ index, style }: { index: number; style: React.CSSProperties }) => (
    <div style={style}>
      <MessageCard message={messages[index]} />
    </div>
  )

  return (
    <List
      height={600}
      itemCount={messages.length}
      itemSize={80}
    >
      {Row}
    </List>
  )
}
```

## ğŸ“‹ ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] ä½¿ç”¨æˆç†Ÿç»„ä»¶åº“ï¼Œé¿å…è‡ªå®šä¹‰
- [ ] TypeScriptç±»å‹å®Œæ•´ï¼Œæ— anyç±»å‹
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ³¨é‡Šå®Œæ•´ï¼ŒJSDocè§„èŒƒ
- [ ] æ— é‡å¤ä»£ç 
- [ ] æ— æœªä½¿ç”¨å˜é‡/å‡½æ•°

### æ¶æ„æ£€æŸ¥
- [ ] ç»„ä»¶èŒè´£å•ä¸€
- [ ] çŠ¶æ€ç®¡ç†åˆç†
- [ ] APIè®¾è®¡ç»Ÿä¸€
- [ ] é”™è¯¯å¤„ç†ç»Ÿä¸€
- [ ] é…ç½®ç®¡ç†ç»Ÿä¸€

### æ€§èƒ½æ£€æŸ¥
- [ ] ä»£ç åˆ†å‰²åˆç†
- [ ] æ‡’åŠ è½½ä½¿ç”¨
- [ ] ç¼“å­˜ç­–ç•¥å®Œå–„
- [ ] å†…å­˜æ³„æ¼é˜²æŠ¤
- [ ] æ¸²æŸ“ä¼˜åŒ–

## âš ï¸ é‡è¦æé†’

1. **æˆç†Ÿåº“ä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨æˆç†Ÿç»„ä»¶åº“ï¼Œè‡ªå®šä¹‰ä»£ç å æ¯” < 20%
2. **å…¨å±€ä¸€è‡´æ€§**: ç¡®ä¿é…ç½®ã€é”™è¯¯å¤„ç†ã€APIè®¾è®¡å…¨å±€ä¸€è‡´
3. **ä»£ç è´¨é‡**: é›¶å®¹å¿é”™è¯¯ï¼Œä¸¥æ ¼ç±»å‹æ£€æŸ¥
4. **æ€§èƒ½ä¼˜åŒ–**: ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€ç¼“å­˜ç­–ç•¥
5. **å®‰å…¨é˜²æŠ¤**: è¾“å…¥éªŒè¯ã€è¾“å‡ºç¼–ç ã€æƒé™æ§åˆ¶

**è®°ä½: å¥½çš„ä»£ç æ˜¯è®¾è®¡å‡ºæ¥çš„ï¼Œä¸æ˜¯æ”¹å‡ºæ¥çš„ã€‚ä¼˜å…ˆä½¿ç”¨æˆç†Ÿè§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿é¡¹ç›®é«˜è´¨é‡äº¤ä»˜ã€‚**